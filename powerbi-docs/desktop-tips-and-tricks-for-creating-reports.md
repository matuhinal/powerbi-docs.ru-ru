---
title: Советы и рекомендации по созданию отчетов в Power BI
description: Ознакомьтесь с рекомендациями по созданию отчетов в службе Power BI и Power BI Desktop
author: davidiseminger
manager: kfile
ms.reviewer: willthom
ms.custom: seodec18
ms.service: powerbi
ms.subservice: powerbi-service
ms.topic: conceptual
ms.date: 05/08/2019
ms.author: davidi
ms.openlocfilehash: 41e5ff75e9b6fd48e3101d30999e8d570f34a270
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "65514020"
---
# <a name="tips-and-tricks-for-creating-reports-in-power-bi-desktop"></a>Советы и рекомендации по созданию отчетов в Power BI Desktop
Для максимально эффективного использования данных иногда требуется небольшая помощь. Мы собрали некоторые советы и рекомендации по созданию отчетов в выпусках Microsoft Power BI Desktop *и* Microsoft Excel 2016 или Microsoft Excel 2013 Professional Plus с включенной надстройкой Power Pivot и установленным и включенным компонентом Power Query. 

## <a name="learning-to-use-the-query-editor"></a>Обучение работе с редактором запросов
Редактор запросов в Power BI Desktop предоставляет практически те же возможности, что и надстройка Power Query в Excel 2013. Несмотря на наличие нескольких полезных статей в разделе поддержки Power BI, перед началом работы имеет смысл изучить документацию по Power Query на сайте support.office.com.

Дополнительные сведения см. в [Центре ресурсов Power Query](https://support.office.com/article/Microsoft-Power-Query-for-Excel-Help-2b433a85-ddfb-420b-9cda-fe0e60b82a94).

Вы также можете ознакомиться со [справочником формул](https://support.office.com/Article/Learn-about-Power-Query-formulas-6bc50988-022b-4799-a709-f8aafdee2b2f).

## <a name="data-types-in-query-editor"></a>Типы данных в редакторе запросов
При использовании редактора запросов в Power BI Desktop для загрузки данных обнаружение типа данных выполняется на основе предположений. При использовании формул иногда параметры типа данных для столбцов не сохраняются. Убедитесь, что тип данных столбцов верны после выполнения следующих операций:  первоначальная загрузка данных на вкладку запросов, выполнение команд "Использовать первую строку в качестве заголовка", "Добавить столбец", "Группировать по", "Объединить", "Добавить", а также перед первой загрузкой данных.

Следует помнить следующее: курсив в сетке данных не означает, что тип данных установлен верно, — это означает. что данные не считаются текстом.

## <a name="reference-queries-in-the-query-editor"></a>Запросы по ссылке в редакторе запросов
В навигаторе редактора запросов в Power BI Desktop при щелчке правой кнопкой мыши один из запросов, параметр «Ссылка» доступна. Это удобно по одной из следующих причин.

* При использовании файлов в качестве источника данных для запроса абсолютный путь к файлу сохраняется в запросе. Совместное использование или перемещение файла Power BI Desktop или книги Excel экономит время при обновлении путей: достаточно однократно обновить элемент, не внося изменения в пути.

По умолчанию все запросы загружаются в лист Excel и модель данных (либо в оба хранилища). Некоторые запросы являются промежуточными шагами и не предназначен для конечных пользователей. Так часто происходит при создании ссылки на запросы, как было сказано выше. Вы можете управлять поведением загрузки правой кнопкой мыши запрос в навигаторе и переключив параметр «Включить загрузку» запросов. Когда *включить загрузку* стоит флажок рядом с ним, запрос по-прежнему доступен на вкладке "запрос" и его можно использовать с другими запросами. Это особенно полезно в сочетании с преобразованиями объединения, добавления и создания ссылок. Поскольку результаты запроса не загружены в модель данных, запрос не будет отображаться в списке полей отчетов вашей модели данных. 

## <a name="scatter-charts-need-a-point-identifier"></a>Точечным диаграммам требуется идентификатор точки
Используя в качестве примера простую таблицу температур и времени замера. Если отобразить эти значения непосредственно на точечной диаграмме, Power BI агрегирует все значения в одну точку. Для отображения отдельных точек данных, можно также добавить поле в контейнер "Сведения" в поле. В Power BI Desktop можно легко сделать это на вкладке запросов: щелкните параметр "Добавить столбец индекса" на ленте "Добавить столбец". 

## <a name="reference-lines-in-your-report"></a>Строки ссылок в отчете
В Power BI Desktop можно воспользоваться вычисляемым столбцом для определения строки ссылки. Определите таблицу и столбец, в которых требуется создать строку ссылки. Выберите "Новый столбец" на ленте и в строке формул введите следующую формулу:

    Target Value = 100

Этот вычисляемый столбец возвратит значение 100, независимо от места использования. Новый столбец отобразится в списке полей. Добавьте вычисляемый столбец "Целевое значение" на линейную диаграмму, чтобы показать, как та или иная серия связана с конкретной строкой ссылки. 

## <a name="sort-by-another-column"></a>Сортировка по другому столбцу
При использовании категориального значения (строки) в Power BI в качестве осей диаграммы в среде или фильтре по умолчанию используется алфавитный порядок. Если требуется переопределить этот порядок, например для дней недели или месяцев, затем можно сообщить Power BI Desktop выполнял сортировку по другому столбцу. Дополнительные сведения см. в разделе [Сортировка по столбцу в Power BI Desktop](desktop-sort-by-column.md).

## <a name="building-maps-more-easily-with-hints-to-bing"></a>Упрощенное построение карт с использованием указаний на Bing
Power BI интегрируется с Bing для предоставления картографических координат по умолчанию (этот процесс называется геокодированием), что упрощает создание карт. Bing использует определенные алгоритмы и подсказки, чтобы точнее определить местоположение, но все равно это лишь предположение. Чтобы увеличить вероятность правильного геокодирования, можно использовать следующие советы.

При создании карты часто приходится наносить на нее определенные страны, регионы и города. В Power BI Desktop, если воспользоваться столбцами названий после географического обозначения, Bing будет проще угадать, что нужно отобразить. Так, если имеется поле с названиями штатов США, например "Калифорния" или "Вашингтон", Bing в ответ на ввод слова "Вашингтон" может отобразить "Вашингтон, округ Колумбия" вместо штата Вашингтон. Если присвоить столбцу имя "Штат", точность геокодирования повысится. То же самое можно сказать и о столбцах "Страна" и "Город". 

Некоторые географические обозначения неоднозначны в контексте разных стран и регионов. В некоторых случаях то, что в одной стране или регионе считается штатом, в другой называется провинцией, графством или как-либо иначе. Чтобы повысить точность геокодирования, можно создать столбцы, объединяющие несколько полей и затем использующие эти поля для нанесения на карту расположений данных. Для того чтобы получить более точный результат геокодирования, можно передать "Уилтшир, Англия" вместо просто "Уилтшир". 

В службе Power BI и Desktop вы всегда можете указать конкретные широту и долготу местоположения. При этом также необходимо передать поле "Расположение". В противном случае данные будут агрегироваться по умолчанию и полученные широта и долгота могут не соответствовать вашим ожиданиям.

## <a name="categorizing-geographic-fields-to-hint-bings-geocoding"></a>Категоризация географических полей для использования геокодирования Bing
Обеспечить правильное геокодирование полей можно, указав для полей данных категорию данных. В Power BI Desktop выберите нужную таблицу, перейдите к расширенной ленты и затем задайте категорию данных для адрес, Город, континент, страны или региона, страны, почтовый индекс, край, округ. Эти категории данных помогают Bing правильно расшифровать данные. Дополнительные сведения см. в разделе [Категоризация данных в Power BI Desktop](desktop-data-categorization.md).

## <a name="better-geocoding-with-more-specific-locations"></a>Улучшение геокодирования благодаря более точному указанию местоположений
Иногда указания категорий данных для сопоставления недостаточно. Воспользовавшись редактором запросов в Power BI Desktop, создайте более конкретное местоположение, например адрес доставки. Используйте функцию "Добавить столбец" для создания пользовательского столбца. Затем создайте нужное местоположение следующим образом. 

    = [Field1] & " " & [Field2]

Затем используйте полученное поле в визуализациях карт. Это полезно для адресов из полей "Адрес доставки", которые часто используются в наборах данных. Стоит отметить, однако, что подобное объединение работает только для текстовых полей. При необходимости преобразуйте номер улицы в данные текстового типа, прежде чем использовать его для формирования адреса.

## <a name="histograms-in-the-query-stage"></a>Гистограммы на этапе запроса
В Power BI Desktop существует несколько способов построения гистограмм. Мы начнем с простейшего и перейдем к более сложным.

Простейшие гистограммы: определите, в каком запросе имеется поле, на основе которого требуется построить гистограмму. Воспользуйтесь параметром "Ссылка" для запроса, чтобы создать новый запрос, и назовите его "Гистограмма FieldName". Используйте параметр "Группировать по" на ленте "Преобразование" и выберите агрегатную функцию "подсчет строк". Убедитесь, что для получаемого агрегатного столбца используется тип данных число. Затем представьте эти данные на странице отчетов. Этот способ простой и быстрый, однако он не работает при наличии множества точек данных и не допускает перебора визуальных элементов.

Определение контейнеров для создания гистограммы: определите, в каком запросе имеется поле, на основе которого требуется построить гистограмму. Воспользуйтесь параметром "Ссылка" для запроса, чтобы создать новый запрос, и назовите его FieldName. Теперь можно определите контейнеры с правилом. Используйте параметр "Добавить настраиваемый столбец" и создайте настраиваемое правило. Простое правило создания контейнеров может выглядеть следующим образом.

    if([FieldName] \< 2) then "\<2 min" else
    if([FieldName] \< 5) then "\<5 min" else
    if([FieldName] \< 10) then "\<10 min" else
    if([FieldName] \< 30) then "\<30 min" else
    "longer")

Убедитесь, что для получаемого агрегатного столбца используется тип данных число. Теперь можно использовать метод "Группировать по", описанный в разделе "Простейшая гистограмма", чтобы создать гистограмму. Этот параметр обрабатывает больше точек данных, но по-прежнему не позволяет выполнять перебор.

Определение гистограммы, которая поддерживает перебор. перебор — перебор визуальные элементы связаны друг с другом, когда пользователь выбирает одну точку данных в одном визуальном, другие визуальные элементы на странице отчета выделяли или фильтровали точки данных, связанные с выбранной точки данных. Поскольку мы обрабатываем данные во время запроса, потребуется создать связь между таблицами и убедиться, что мы знаем, какой элемент сведений относится к контейнеру на гистограмме, и наоборот.

Запустите процесс, воспользовавшись параметром "Ссылка" в запросе, который содержит поле, на основе которого требуется построить гистограмму. Назовите запрос "Контейнеры". Для этого примера назовем исходный запрос "Сведения". Удалите все столбцы, кроме столбца, который будет использоваться как контейнер для гистограммы. Теперь воспользуйтесь функцией "Удалить дубликаты" в контекстном меню запроса, предварительно выделив столбец, после чего в столбце останутся только уникальные значения. Если имеются десятичные числа, сначала можно воспользоваться рекомендацией по определению контейнеров для создания гистограммы, чтобы получить управляемый набор контейнеров. Проверьте данные, которые отображаются в области предварительного просмотра запроса. Если вы увидите пустые значения или значения null, перед созданием связи потребуется их исправить. См. раздел "Создание связи при наличии в данных значений null или пустых значений". Использовать этот метод может быть проблематично из-за необходимости выполнить сортировку. Чтобы обеспечить правильность сортировки контейнеров, воспользуйтесь инструкциями в разделе "Порядок сортировки: отображение категорий в нужном порядке". 

>[!NOTE]
>Имеет смысл подумать о порядке сортировки до начала создания любых визуальных элементов. 

Далее необходимо определить связь между запросами "Контейнеры" и "Сведения" в столбце контейнеров. В Power BI Desktop щелкните **Управление связями** на ленте. Создайте связь с запросами "Контейнеры" в левой таблице и запросами "Сведения" в правой таблице, а затем выберите поле, которое используется для создания гистограммы. 

Затем нужно создать гистограмму. Перетащите поле "Контейнер" из таблицы "Контейнеры". Удалите поле по умолчанию из получившейся столбчатой диаграммы. Теперь перетащите поле гистограммы из таблицы "Сведения" в тот же визуальный элемент. В списке полей измените статистическое выражение по умолчанию на "Количество". Результатом является гистограмма. При создании другого (древовидного) визуального элемента из таблицы "Сведения" выберите точку данных на древовидной диаграмме, чтобы увидеть выделенную гистограмму и показать гистограмму для выбранной точки данных относительно тенденции для всего набора данных.

## <a name="histograms"></a>Гистограммы
Для определения гистограммы в Power BI Desktop можно воспользоваться вычисляемым полем. Определите таблицу и столбец, на основе которых требуется создать гистограмму. В области вычислений введите следующую формулу:

> Frequency:=COUNTROWS(\<имя столбца\>)
> 
> 

Сохраните изменения и вернитесь к отчету. Добавьте \<имя столбца\> и частоту в таблицу, а затем выполните преобразование в линейчатую диаграмму. Убедитесь, что \<имя столбца\> находится на оси x, а вычисляемое поле с частотой — на оси y.

## <a name="tips-and-tricks-for-creating-relationships-in-power-bi-desktop"></a>Советы и рекомендации по созданию связей в Power BI Desktop
Часто при загрузке наборов подробных данных из многочисленных источников созданию связей мешают такие проблемы, как наличие значений null, пустых или дублирующихся значений. 

Давайте рассмотрим пример. 

Допустим, мы загружаем набор данных из активных запросов поддержки клиентов и другой набор данных, состоящий из рабочих элементов со следующими схемами:

> CustomerInicdents: {IncidentID, CustomerName, IssueName, OpenedDate, Status} WorkItems: {WorkItemID, IncidentID, WorkItemName, OpenedDate, Status, CustomerName } 
> 
> 

Если требуется отслеживать все инциденты и рабочие элементы, связанные с определенным CustomerName, невозможно просто создать связь между двумя этими наборами данных. Некоторые рабочие элементы могут быть не связаны с CustomerName, поэтому это поле будет пустым или будет иметь значение NULL. В элементах WorkItems и CustomerIncidents может быть несколько записей для любого заданного CustomerName. 

### <a name="creating-relationships-in-power-bi-desktop-when-the-data-has-null-or-blank-values"></a>Создание связей в Power BI Desktop при наличии в данных значений null или пустых значений
Очень часто наборы данных содержат столбцы с пустыми значениями или значениями null. Это может вызвать проблемы при попытке использования связей. Эту проблему можно решить двумя способами. Можно удалить строки, содержащие значения null или пустые значения. Для этого можно воспользоваться функцией фильтрации на вкладке запросов или, если выполняется слияние запросов, выбрать параметр "Оставить только совпадающие строки". Кроме того, можно заменить значения null или пустые значения значениями, которые хорошо работают в связях: как правило, это строки NULL и "(Blank)". Идеального решения здесь не существует: если отфильтровать строки на этапе запроса, часть строк будет удалена, что может повлиять на сводную статистику и вычисления. При втором подходе эти строки данных сохраняются, однако несвязанные строки могут отображаться в модели как связанные, в результате чего в вычислениях могут возникать ошибки. Если вы решите воспользоваться вторым подходом, не забудьте использовать нужные фильтры в представлении Вид/Диаграмма, чтобы получить точные результаты. Очень важно оценить, какие строки сохраняются, а какие удаляются, и понять общее влияние этого на анализ. 

### <a name="creating-relationships-in-power-bi-desktop-when-the-data-has-duplicate-values"></a>Создание связей в Power BI Desktop при наличии в данных повторяющихся значений
Часто при загрузке наборов подробных данных из многочисленных источников созданию связей мешают дублирующиеся значения данных. Для решения этой проблемы можно создать таблицу измерений с уникальными значениями из обоих наборов данных. 

Давайте рассмотрим пример. 

Допустим, мы загружаем набор данных из активных запросов поддержки клиентов и другой набор данных, состоящий из рабочих элементов со следующими схемами:

> CustomerInicdents: {IncidentID, CustomerName, IssueName, OpenedDate, Status} WorkItems: {WorkItemID, IncidentID, WorkItemName, OpenedDate, Status, CustomerName } 
> 
> 

Если требуется отслеживать все инциденты и рабочие элементы, связанные с определенным CustomerName, невозможно просто создать связь между двумя этими наборами данных. Некоторые рабочие элементы могут быть не связаны с CustomerName, поэтому это поле будет пустым или будет иметь значение NULL. Если в таблице CustomerNames имеются какие-либо пустые значения или значения null, возможно, вам по-прежнему не удастся создать связь. См. информацию в разделе "Создание связей при наличии в данных значений null или пустых значений". В одной таблице CustomerName может присутствовать несколько элементов WorkItems и CustomerIncidents. 

Для создания связи в этом случае потребуется создать логический набор данных всех элементов CustomerNames для двух наборов данных. На вкладке "Запрос" для создания логического набора данных можно воспользоваться следующей последовательностью.

1. Продублируйте оба запроса, назвав первый **Temp** , а второй **CustomerNames**.
2. Из каждого запроса удалите все столбцы, *кроме* CustomerName
3. В каждом запросе воспользуйтесь командой  **Удалить дубликат**.
4. В запросе **CustomerNames** выберите на ленте команду **Добавить** , а затем выберите запрос **Temp**.
5. В запросе **CustomerNames** выберите **Удалить дубликаты**.

Теперь имеется таблица измерений, которую можно использовать для связывания запросов CustomerIncidents и WorkItems и которая содержит все значения каждого из них. 

## <a name="patterns-to-jump-start-your-use-of-the-query-editor"></a>Шаблоны начального уровня для работы с редактором запросов
Редактор запросов — очень мощный инструмент обработки данных, позволяющий формировать и очищать их, подготавливая к визуализации или моделированию. Следует помнить о некоторых правилах.

### <a name="temporary-columns-can-be-deleted-after-computing-a-result"></a>После вычисления результата можно удалить временные столбцы.
В Power BI Desktop часто необходимо создавать вычисление, которое преобразует данные из нескольких столбцов в один. Иногда это непросто. Один из удобных способов решения проблемы — разбиение процедуры на шаги. Начните с дублирования исходных столбцов. Затем создайте временные столбцы. Затем создайте столбец для окончательного результата. Затем можно удалить временные столбцы, чтобы не засорять окончательный набор данных. Это возможно, так как на вкладке запросов все шаги выполняются в последовательности. 

### <a name="duplicate-or-reference-queries-followed-by-merge-to-original-query"></a>Дублирующиеся запросы или запросы по ссылке, объединяемые с исходным запросом
Иногда полезно вычислить сводную статистику для набора данных. Для этого можно дублировать запрос на вкладке запросов или сослаться на него. Затем с помощью команды **Группировать по** вычислите сводную статистику. Сводная статистика помогает нормализовать данные в исходных данных, чтобы их стало удобнее сравнивать. Это особенно полезно для сравнения отдельных значений и целого. Для этого перейдите в исходный запрос и выберите вариант слияния. Затем объедините данные из запроса сводной статистики, соответствующего подходящим идентификаторам. Теперь все готово для нормализации данных так, как нужно для вашего анализа.

## <a name="using-dax-for-the-first-time"></a>Использование DAX впервые
DAX — это язык формулы вычислений в Power BI Desktop. Он оптимизирован для бизнес-аналитики. Он несколько отличается от привычного вам, если ранее в качестве языка запросов вы использовали только SQL. Существует множество хороших ресурсов (в Интернете и не только), позволяющих изучить DAX. 

[Основные сведения о DAX в Power BI Desktop](desktop-quickstart-learn-dax-basics.md)

[Руководство по выражениям анализа данных (DAX)](https://msdn.microsoft.com/library/gg413422.aspx)

[Центр ресурсов DAX](http://social.technet.microsoft.com/wiki/contents/articles/1088.dax-resource-center.aspx)
