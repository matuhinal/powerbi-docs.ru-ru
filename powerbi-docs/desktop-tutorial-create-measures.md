---
title: Руководство. Создание собственных мер в Power BI Desktop
description: Меры в Power BI Desktop полезны тем, что они выполняют вычисления с вашими данными, когда вы работаете с отчетами.
author: davidiseminger
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-desktop
ms.topic: tutorial
ms.date: 11/08/2019
ms.author: davidi
LocalizationGroup: Learn more
ms.openlocfilehash: 0d2b316b53b4107c86a036cc8a436440dd8bd674
ms.sourcegitcommit: 7aa0136f93f88516f97ddd8031ccac5d07863b92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "74311519"
---
# <a name="tutorial-create-your-own-measures-in-power-bi-desktop"></a>Руководство. Создание собственных мер в Power BI Desktop
С помощью мер можно создать некоторые эффективные решения для анализа данных в Power BI Desktop. Меры полезны тем, что они выполняют вычисления с вашими данными, когда вы работаете с отчетами. В этом руководстве объясняется, что такое меры, и как создать несколько собственных базовых мер в Power BI Desktop.

## <a name="prerequisites"></a>Предварительные требования

- Это руководство предназначено для пользователей Power BI, которые знают, как использовать Power BI Desktop для создания более сложных моделей. Вы должны уметь использовать запрос для импорта данных, работать с несколькими связанными таблицами и добавлять поля на холст отчета. Если вы еще не знакомы с Power BI Desktop, прочтите статью [Начало работы с Power BI Desktop](desktop-getting-started.md).
  
- В этом руководстве используется файл [Contoso Sales Sample for Power BI Desktop](https://download.microsoft.com/download/4/6/A/46AB5E74-50F6-4761-8EDB-5AE077FD603C/Contoso%20Sales%20Sample%20for%20Power%20BI%20Desktop.zip), который содержит данные о продаже товаров через Интернет, относящиеся к вымышленной компании Contoso. Так как эти данные импортированы из базы данных, вы не можете подключиться к источнику данных или просмотреть его в редакторе запросов. Скачайте и распакуйте файл на компьютере.

## <a name="automatic-measures"></a>Автоматические меры

Создание мер в Power BI Desktop чаще всего осуществляется автоматически. Чтобы узнать, как Power BI Desktop создает меру, выполните следующие действия.

1. В Power BI Desktop выберите **Файл** > **Открыть**, перейдите к файлу *Contoso Sales Sample for Power BI Desktop.pbix* и нажмите кнопку **Открыть**.

2. В области **Поля** разверните таблицу **Sales** (Продажи). Затем либо установите флажок рядом с полем **SalesAmount**, либо перетащите **SalesAmount** на холст отчета.

    Отображается новая визуализация в виде гистограммы, на которой показана сумма всех значений в столбце **SalesAmount** таблицы **Sales** (Продажи).

    ![Гистограмма SalesAmount](media/desktop-tutorial-create-measures/meastut_salesamountchart.png)

Любое поле (любой столбец) в области **Поля** со ![значком "сигма"](media/desktop-tutorial-create-measures/meastut_sigma.png) является числовым, и с его значениями можно выполнять статистические вычисления. Чтобы не выводить таблицу со множеством значений (два миллиона строк для **SalesAmount**), Power BI Desktop автоматически создает и вычисляет меру для статистической обработки данных при обнаружении числового типа данных. Сумма — это функция статистической обработки по умолчанию для числовых данных. Но вы можете легко применить другой тип, например вычисление среднего значения или подсчет. Без понимания статистических вычислений вы не сможете работать с мерами, так как каждая мера выполняет статистическое вычисление определенного типа. 

Чтобы изменить статистическое вычисление диаграммы, сделайте следующее.

1. Выберите визуализацию **SalesAmount** на холсте отчета.  

1. В области **Значение** панели **Визуализации** щелкните стрелку вниз справа от элемента **SalesAmount**. 

1. В открывшемся меню выберите пункт **Среднее**. 

    Визуализация изменяется и отображает среднее значение всех продаж в поле **SalesAmount**.

    ![Диаграмма с отображаемым средним значением SalesAmount](media/desktop-tutorial-create-measures/meastut_salesamountaveragechart.png)

Вы можете изменять тип статистического вычисления в зависимости от требуемого результата. Однако не все типы статистического вычисления применяются к каждому числовому типу данных. Например, для поля **SalesAmount** имеет смысл вычислить сумму и среднее значение, а также минимум и максимум. Но подсчет количества для поля **SalesAmount** не имеет смысла, так как, хотя его значения и числовые, они представляют денежные значения.

Значения, вычисленные из мер, изменяются по мере работы с отчетом. Например, если перетащить поле **RegionCountryName** из таблицы **Geography** (География) на существующую диаграмму **SalesAmount**, то для каждой страны отобразится среднее значение объема продаж.

![Объем продаж по странам](media/desktop-tutorial-create-measures/meastut_salesamountavchartbyrcn.png)

Когда из-за работы с отчетом изменяется результат меры, вы влияете на *контекст* меры. Каждый раз при взаимодействии с визуализациями отчетов вы изменяете контекст, в котором вычисляются и отображаются результаты меры.

## <a name="create-and-use-your-own-measures"></a>Создание и использование собственных мер

В большинстве случаев Power BI автоматически вычисляет и возвращает значения в зависимости от выбранных типов полей и агрегатов. Однако в других случаях может потребоваться создать собственные меры для выполнения более сложных, уникальных вычислений. С помощью Power BI Desktop вы можете создавать собственные меры на языке формул DAX. 

В формулах DAX используются многие функции, операторы и синтаксис из формул Excel. Но функции DAX предназначены для работы с реляционными данными и выполнения более динамических вычислений по мере вашей работы с отчетами. Существует более 200 функций DAX, которые делают все: от простых вычислений, таких как подсчет суммы и среднего значения, до более сложных статистических функций и функций фильтрации. Доступно множество материалов по DAX. Закончив работу с этим руководством, ознакомьтесь со статьей [Основные сведения о DAX в Power BI Desktop](desktop-quickstart-learn-dax-basics.md).

Когда вы создаете собственную меру, она называется мерой *модели* и добавляется в список **Поля** для выбранной вами таблицы. Одно из главных преимуществ мер модели заключается в том, что вы можете присвоить им любое имя, упрощая их определение. Кроме того, меры можно использовать в качестве аргументов в других выражениях DAX. Также можно создавать меры, которые быстро выполняют сложные вычисления.

### <a name="quick-measures"></a>Быстрые меры

Начиная с выпуска Power BI Desktop за февраль 2018 г., большинство стандартных вычислений доступны в виде *быстрых мер*. Они позволяют создавать формулы DAX на основе входных данных, которые вы вводите в окне. Эти быстрые и эффективные вычисления также отлично подходят для изучения DAX или присвоения начальных значений для своих пользовательских мер. 

Создайте быструю меру, используя один из следующих методов. 
 - В таблице в области **Поля** щелкните правой кнопкой мыши или выберите пункт **Дополнительные параметры** ( **...** ), а затем выберите **Новая быстрая мера** в списке.

 - В разделе **Вычисления** на вкладке **Главная** ленты Power BI Desktop выберите **Новая быстрая мера**.

Дополнительные сведения о создании и использовании быстрых мер см. в разделе [Использование быстрых мер](desktop-quick-measures.md).

### <a name="create-a-measure"></a>Создание меры

Предположим, что вам нужно проанализировать чистую выручку от продаж, вычтя скидки и возвраты из общей суммы продаж. Вам потребуется мера, которая, независимо от контекста в визуализации, должна вычесть сумму DiscountAmount и ReturnAmount из суммы SalesAmount. В списке **Поля** нет поля с именем Net Sales (Чистая выручка от продаж). Но есть стандартные блоки, с помощью которых можно создать собственную меру для вычисления чистой выручки от продаж. 

Чтобы создать меру, сделайте следующее:

1. В области **Поля** щелкните правой кнопкой мыши таблицу **Sales** (Продажи) или наведите указатель на таблицу и выберите пункт **Дополнительные параметры** ( **...** ). 

1. В открывшемся меню выберите пункт **Создать меру**. 

    Новая мера сохраняется в таблице **Sales** (Продажи), где ее легко найти.
    
    ![Создание меры из списка](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure.png)
    
    Вы также можете создать меру, нажав кнопку **Создать меру** в группе **Вычисления** на вкладке **Главная** ленты в Power BI Desktop.
    
    ![Создание меры с помощью ленты](media/desktop-tutorial-create-measures/meastut_netsales_newmeasureribbon.png)
    
    >[!TIP]
    >Если мера создается с помощью ленты, ее можно создать в любой таблице. Но меру будет проще найти, если создать ее там, где она будет использоваться. В данном случае сначала выберите таблицу **Sales** (Продажи), чтобы сделать ее активной, а затем выберите **Создать меру**. 
    
    В верхней части холста отчета появится строка формул, в которой можно переименовать меру и ввести формулу DAX.
    
    ![Строка формул](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formulabar.png)
    
1. По умолчанию каждая новая мера получает имя *Measure* (Мера). Если ее не переименовать, другие новые меры получат имена *Measure 2*, *Measure 3* и т. д. Чтобы меру было проще определить, выделите *Measure* в строке формул и введите *Net Sales* (Чистая выручка от продаж).
    
1. Начните вводить формулу. После знака равенства начните вводить *SUM*. По мере ввода отобразится раскрывающийся список предложений со всеми функциями DAX, начинающимися с веденной вами буквы. Прокрутите список вниз, чтобы выбрать в нем **SUM**, и нажмите клавишу **ВВОД**.
    
    ![Выбор функции SUM в списке](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_s.png)
    
    Появится открывающая круглая скобка вместе с раскрывающимся списком предложений для доступных столбцов, которые можно передать в функцию SUM.
    
    ![Выбор столбца](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_sum.png)
    
1. Выражения всегда появляются между открывающей и закрывающей скобкой. В этом примере выражение содержит один аргумент, передаваемый в функцию SUM: столбец **SalesAmount**. Начните вводить *SalesAmount*, пока в списке не останется только значение **Sales(SalesAmount)** . 

    Имя столбца, которому предшествует имя таблицы, называется полным именем столбца. Полные имена столбцов делают формулы более удобными для чтения.
    
    ![Выбор столбца SalesAmount](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_salesam.png)
    
1. Выберите **Sales[SalesAmount]** в списке, а затем введите закрывающую круглую скобку.
    
    > [!TIP]
    > Синтаксические ошибки чаще всего бывают вызваны отсутствующей или неправильно расположенной закрывающей скобкой.
    
    
    
1. Вычтите два других столбца внутри формулы.

    а. После закрывающей круглой скобки для первого выражения введите пробел, затем оператор "минус" (-) и еще один пробел. 

    б. Введите другую функцию SUM и начните вводить текст *DiscountAmount*, пока не отобразится имя столбца **Sales[DiscountAmount]** , которое можно выбрать в качестве аргумента. Добавьте закрывающую круглую скобку. 

    в. Введите пробел, оператор "минус", пробел, еще одну функцию SUM со столбцом **Sales[ReturnAmount]** в качестве аргумента и закрывающую круглую скобку.
    
    ![Полная формула](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_discamount.png)
    
1. Нажмите клавишу **ВВОД** или выберите значок **Фиксировать** (галочка) в строке формул, чтобы завершить и проверить формулу. 

    Теперь проверенная мера **Net Sales** (Чистая выручка от продаж) готова к использованию для таблицы **Sales** (Продажи) в области **Поля**.
    
    ![Мера Net Sales (Чистая выручка от продаж) в списке полей таблицы Sales (Продажи)](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_complete.png)
    
1. Если при вводе формулы вам не хватило места или нужно разделить формулу на несколько строк, выберите стрелку вниз справа от строки формулы, чтобы появилось больше места. 

    Стрелка вниз превращается в стрелку вверх, и появляется большое поле.

    ![Стрелка вверх для формулы](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_chevron.png)

1. Разделите формулу на части, нажав клавиши **ALT** + **ВВОД** для разделения на строки или клавишу **TAB** для добавления табуляции.

   ![Развернутая формула](media/desktop-tutorial-create-measures/meastut_netsales_newmeasure_formula_expanded.png)

### <a name="use-your-measure-in-the-report"></a>Использование меры в отчете
Вы можете добавить новую меру **Net Sales** (Чистая выручка от продаж) на холст отчета, чтобы вычислять чистую выручку от продаж независимо от других полей, добавляемых в отчет. 

Чтобы посмотреть чистую выручку от продаж по странам, сделайте следующее:

1. Выберите меру **Net Sales** в таблице **Продажи**, чтобы перетащить ее на холст отчета.
    
1. Выберите поле **RegionCountryName** в таблице **Geography** (География) или перетащите его на диаграмму **Net Sales** (Чистая выручка от продаж).
    
    ![Чистая выручка от продаж по странам](media/desktop-tutorial-create-measures/meastut_netsales_byrcn.png)
    
1. Чтобы увидеть разницу между чистой выручкой от продаж и суммой продаж по странам, выберите поле **SalesAmount** и перетащите его на диаграмму. 

    ![Сумма продаж и чистая выручка от продаж по странам](media/desktop-tutorial-create-measures/meastut_netsales_byrcnandsalesamount.png)

    Теперь в диаграмме используются две меры: **SalesAmount**, которую решение Power BI суммировало автоматически, и созданная вами мера **Net Sales** (Чистая выручка от продаж). Каждая мера вычисляется в контексте другого поля — **RegionCountryName**.
    
### <a name="use-your-measure-with-a-slicer"></a>Использование меры со срезом

Вы можете добавить срез, чтобы можно было фильтровать суммы чистой выручки от продаж и суммы продаж по календарным годам.
    
1. Выберите пустую область рядом с диаграммой. На панели **Визуализации** выберите визуализацию **Таблица**. 

    На холсте отчета создается визуализация пустой таблицы.
    
    ![Новая визуализация пустой таблицы](media/desktop-tutorial-create-measures/meastut_netsales_blanktable.png)
    
1. Перетащите поле **Year** (Год) из таблицы **Calendar** (Календарь) на новую визуализацию пустой таблицы. 
    
    Так как **Year** (Год) — это числовое поле, Power BI Desktop суммирует его значения. Такая сумма плохо подходит для статистической обработки. Мы исправим это в следующем шаге.

    ![Статистические вычисления в столбце Year](media/desktop-tutorial-create-measures/meastut_netsales_yearaggtable.png)
    
3. В области **Значения** на панели **Визуализации** выберите стрелку вниз рядом со столбцом **Year** (Год), а затем выберите **Не суммировать** в списке. Теперь в таблице отображаются отдельные годы.
    
    ![Выбор пункта "Не суммировать"](media/desktop-tutorial-create-measures/meastut_netsales_year_donotsummarize.png)
    
4.  Выберите значок **среза** на панели **Визуализации**, чтобы преобразовать таблицу в срез. Если визуализация отображает ползунок, а не список, выберите **Список** с помощью стрелки вниз на ползунке.

    ![Преобразование таблицы в срез](media/desktop-tutorial-create-measures/meastut_netsales_year_changetoslicer.png)
    
5.  Выберите любое значение в срезе **Year** (год), чтобы отфильтровать диаграмму **чистой выручки от продаж и суммы продаж по RegionCountryName** соответствующим образом. Меры **Net Sales** (Чистая выручка от продаж) и **SalesAmount** вычисляются заново и показывают результаты только в контексте выбранного поля **Year** (Год). 
    
    ![Диаграмма с примененным срезом по годам](media/desktop-tutorial-create-measures/meastut_netsales_chartslicedbyyear.png)

### <a name="use-your-measure-in-another-measure"></a>Использование меры в другой мере

Предположим, вам нужно узнать, какие продукты имели самую высокую чистую выручку от продаж на проданную единицу. Вам потребуется мера, которая делит чистую выручку от продаж на количество проданных единиц. Создайте меру, которая делит результат меры **Net Sales** (Чистая выручка от продаж) на сумму **Sales[SalesQuantity]** .

1.  В области **Поля** создайте меру с именем **Net Sales per Unit** (Чистая выручка от продаж на единицу) в таблице **Sales** (Продажи).
    
1. В строке формул начните вводить *Net Sales*. В списке предложений отображаются варианты, которые можно добавить. Выберите **[Net Sales]** .
    
    ![Формула, использующая меру Net Sales](media/desktop-tutorial-create-measures/meastut_nspu_formulastep2a.png)
    
1. Можно также сослаться на меру, введя только открывающую квадратную скобку ( **[** ). В списке предложений отображаются только меры, которые можно добавить в формулу.
    
    ![Скобка, после которой отображаются только меры](media/desktop-tutorial-create-measures/meastut_nspu_formulastep2b.png)
    
1. Введите пробел, оператор деления (/), еще один пробел, функцию SUM, а затем введите *Quantity*. В списке предложений отобразятся все столбцы со словом *Quantity* в имени. Выберите **Sales[SalesQuantity]** , введите закрывающую круглую скобку и нажмите клавишу **ВВОД** или значок **Фиксировать** (галочка), чтобы проверить формулу. 

    Итоговая формула должна иметь следующий вид.
    
    `Net Sales per Unit = [Net Sales] / SUM(Sales[SalesQuantity])`
    
1. Выберите меру **Net Sales per Unit** (Чистая выручка от продаж на единицу) в таблице **Sales** (Продажи) или перетащите меру в пустую область на холсте отчета. 

    На диаграмме показана сумма чистой выручки от всех продаж на единицу товара. Эта диаграмма не очень информативна; мы исправим это в следующем шаге.
    
    ![Чистая выручка от всех продаж на единицу](media/desktop-tutorial-create-measures/meastut_nspu_chart.png)
    
1. Чтобы получить другое представление, измените тип визуализации диаграммы на **Диаграмма дерева**.
    
    ![Изменение типа на диаграмму дерева](media/desktop-tutorial-create-measures/meastut_nspu_changetotreemap.png)
    
1. Выберите поле **Product Category** (Категория продукта) или перетащите его на диаграмму "дерево" или поле **Группа** на панели **Визуализации**. Эти сведения уже представляют интерес.
    
    ![Диаграмма дерева с фильтрацией по категориям продуктов](media/desktop-tutorial-create-measures/meastut_nspu_byproductcat.png)
    
7. Попробуйте удалить поле **ProductCategory**, а вместо него перетащить поле **ProductName** на диаграмму. 
    
    ![Диаграмма дерева с фильтрацией по названиям продуктов](media/desktop-tutorial-create-measures/meastut_nspu_byproductname.png)
    
   Сейчас мы просто забавляемся, но нужно признать, что это здорово! Попробуйте другие способы фильтрации и форматирования визуализации.

## <a name="what-youve-learned"></a>Что вы узнали
Меры расширяют возможности получения аналитической информации из данных. Вы узнали, как создавать меры с помощью строки формул, присваивать им имена, которые более удобны для работы, искать и выбирать нужные элементы формулы с помощью списка предложений DAX. Вы также ознакомились с понятием контекста, в котором результаты вычислений в мерах изменяются в соответствии с другими полями или другими выражениями в формуле.

## <a name="next-steps"></a>Дальнейшие действия
- Дополнительные сведения о быстрых мерах Power BI Desktop, которые предоставляют много стандартных вычислений, см. в статье [Использование быстрых мер для простого выполнения стандартных и мощных вычислений](desktop-quick-measures.md).
  
- Чтобы более подробно изучить формулы DAX и создавать более сложные меры, см. статью [Основные сведения о DAX в Power BI Desktop](desktop-quickstart-learn-dax-basics.md). В этой статье описываются основные понятия языка DAX, такие как синтаксис, функции, и дается более глубокое объяснение контекста.
  
- Рекомендуется добавить в избранное [справочник по языку выражений анализа данных (DAX)](https://docs.microsoft.com/dax/index). В нем можно найти подробные сведения о синтаксисе DAX, операторах и более чем о 200 функциях DAX.

