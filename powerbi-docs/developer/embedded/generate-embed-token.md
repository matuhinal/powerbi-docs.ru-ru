---
title: Рекомендации по созданию токена внедрения
description: Сведения о рекомендациях, ограничениях и необходимых разрешениях для создания токена внедрения
author: KesemSharabi
ms.author: kesharab
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-developer
ms.topic: conceptual
ms.custom: ''
ms.date: 10/15/2020
ms.openlocfilehash: 24442f20a0c713deb489cd2461839f2b5da39a30
ms.sourcegitcommit: 1428acb6334649fc2d3d8ae4c42cfbc17e8f7476
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92197709"
---
# <a name="considerations-when-generating-an-embed-token"></a>Рекомендации по созданию токена внедрения

[Создание токена](/rest/api/power-bi/embedtoken) — это REST API, позволяющий создать токен для внедрения элемента Power BI в веб-приложение или на портал. Токен используется для авторизации запроса к службе Power BI.

API создания токена создает токен для отдельного пользователя с помощью единого удостоверения (главного пользователя или субъекта-службы) в зависимости от учетных данных этого пользователя в приложении (действительное удостоверение).

После успешной проверки подлинности предоставляется доступ к соответствующим данным.

>[!NOTE]
>Создание токена применимо только при [*внедрении для клиентов*](embed-sample-for-customers.md) (также называется сценарием *данных, принадлежащих приложению* ).

Для создания токена можно использовать следующие API:

* [Панели мониторинга](/rest/api/power-bi/embedtoken/dashboards_generatetokeningroup)

* [Наборы данных](/rest/api/power-bi/embedtoken/datasets_generatetokeningroup)

* [Создание токена для нескольких отчетов](/rest/api/power-bi/embedtoken/generatetoken)


* [Создание отчета](/rest/api/power-bi/embedtoken/reports_generatetokenforcreateingroup)

* [Отчеты](/rest/api/power-bi/embedtoken/reports_generatetokeningroup)

* [Плитки](/rest/api/power-bi/embedtoken/tiles_generatetokeningroup)

## <a name="workspace-versions"></a>Версии рабочей области

В Power BI доступно две версии рабочей области: *классическая* и *новая* рабочая область. Дополнительные сведения о различиях между новыми и классическими рабочими областями см. в [этом разделе](../../collaborate-share/service-new-workspaces.md#new-and-classic-workspace-differences).

При создании токена внедрения для разных рабочих областей применяются разные рекомендации и требуются разные разрешения.

|                  |*Классическая* рабочая область |*Новая* рабочая область|
|------------------|---------|--------|
|**Рекомендации**|<li>Набор данных и элемент должны находиться в одной рабочей области</li><li>Использовать субъект-службу невозможно</li>  |Набор данных и элемент могут находиться в двух разных *новых* рабочих областях |
|**Разрешения рабочей области**|Главный пользователь должен быть администратором рабочей области  |Субъект-служба и главный пользователь должны быть как минимум участниками обеих рабочих областей |

>[!NOTE]
>* Невозможно создать токен внедрения для раздела [Моя рабочая область](../../consumer/end-user-workspaces.md#types-of-workspaces).
>* Слово *элемент* обозначает элемент Power BI, например панель мониторинга, фрагмент, раздел "Вопросы и ответы" или отчет.

## <a name="securing-your-data"></a>Защита данных

При создании решения рассмотрите два подхода к защите данных:

* [Изоляция на основе рабочей области](embed-multi-tenancy.md#power-bi-workspace-based-isolation)

* [Изоляция на основе безопасности на уровне строк](embed-multi-tenancy.md#row-level-security-based-isolation)

Если планируется использовать подход на основе безопасности на уровне строк (RLS), ознакомьтесь с [разрешениями и ограничениями RLS](generate-embed-token.md#row-level-security) в конце этой статьи.

## <a name="token-permissions"></a>Разрешения для маркеров

В интерфейсах API создания токена в разделе *GenerateTokenRequest* приведены разрешения токена.

>[!NOTE]
>Разрешения токена, указанные в этом разделе, неприменимы для API [Создание токена для нескольких отчетов](/rest/api/power-bi/embedtoken/generatetoken).

### <a name="access-level"></a>Уровень доступа

Для определения уровня доступа пользователя используйте параметр *accessLevel* .

* **Просмотр**  — предоставление пользователю разрешений на просмотр.

* **Изменение**  — предоставление пользователю разрешений на просмотр и изменение (применяется только при создании токена внедрения для отчета).

    При использовании API [Создание токена для нескольких отчетов](/rest/api/power-bi/embedtoken/generatetoken) для предоставления пользователю разрешений на просмотр и изменение используйте параметр *allowEdit* .

* **Создание**  — предоставление пользователю разрешений на создание отчета (применяется только при создании токена внедрения для создания отчета).

    Для создания отчета необходимо также указать параметр *datasetId* .

### <a name="saving-a-copy-of-the-report"></a>Сохранение копии отчета

Используйте логический параметр *allowSaveAs* , чтобы позволить пользователям сохранить отчет в виде нового отчета. По умолчанию для него установлено значение *false* .

Этот параметр применим только при создании токена внедрения для отчета.

### <a name="row-level-security"></a>Безопасность на уровне строк

Параметр [RLS](embedded-row-level-security.md) позволяет использовать удостоверение, отличное от удостоверения субъекта-службы или главного пользователя, с помощью которого создается токен. С помощью этого параметра можно отображать внедренные данные в соответствии с целевым пользователем. Например, в приложении можно попросить пользователей войти в систему, а затем отобразить отчет, содержащий только сведения о продажах, если вошедший пользователь является сотрудником отдела продаж.

При использовании RLS в некоторых случаях можно не задействовать удостоверение пользователя (параметр *EffectiveIdentity* ). Это позволяет токену получить доступ ко всей базе данных. Этот метод можно использовать для предоставления доступа таким пользователям, как администраторы и менеджеры, у которых есть разрешения на просмотр всего набора данных. Но этот метод можно использовать не в каждом сценарии. В следующей таблице представлены различные типы RLS и метод проверки подлинности, который можно использовать без указания удостоверения пользователя.

В таблице также приведены рекомендации и ограничения, применимые к каждому типу RLS.

|Тип RLS  |Можно ли создать токен внедрения без указания действующего удостоверения пользователя?  |Рекомендации и ограничения  |
|---------|---------|---------|
|Облачная функция безопасности на уровне строк (облачная функция RLS)      |✔ Главный пользователь<br/>✖ Субъект-служба          |         |
|RDL (отчеты с разбивкой на страницы)     |✖ Главный пользователь<br/>✔ Субъект-служба        |С помощью главного пользователя создать токен внедрения для RDL невозможно.         |
|Активное локальное подключение к службам Analysis Services (AS)    |✔ Главный пользователь<br/>✖ Субъект-служба         |У пользователя, создающего токен внедрения, также должно быть одно из следующих разрешений:<li>разрешения администратора шлюза;</li><li>разрешение на олицетворение источника данных ( *ReadOverrideEffectiveIdentity* ).</li>         |
|Активное подключение Azure к службам AS    |✔ Главный пользователь<br/>✖ Субъект-служба         |Удостоверение пользователя, создающего токен внедрения, переопределить невозможно. С помощью пользовательских данных можно реализовать динамическую RLS и безопасную фильтрацию.<br/><br/>**Примечание.** Субъект-служба должен предоставить идентификатор объекта в качестве действительного удостоверения (имя пользователя RLS).         |
|Единый вход     |✔ Главный пользователь<br/>✖ Субъект-служба         |Явное удостоверение (единый вход) можно указать с помощью свойства большого двоичного объекта удостоверения в действующем объекте удостоверения.         |
|Единый вход и облачная функция RLS     |✔ Главный пользователь<br/>✖ Субъект-служба         |Необходимо указать следующее:<li>явное удостоверение (единый вход) в свойстве большого двоичного объекта удостоверения в действующем объекте удостоверения;</li><li>действующее (RLS) удостоверение (имя пользователя).</li>         |

>[!NOTE]
>Субъект-служба всегда должен предоставлять следующее:
>* удостоверение для любого элемента с набором данных RLS;
>* для набора данных единого входа действующее удостоверение RLS с определенным свойством имени пользователя.

## <a name="next-steps"></a>Дальнейшие действия

>[!div class="nextstepaction"]
>[Регистрация приложения](register-app.md)

> [!div class="nextstepaction"]
>[Power BI Embedded для клиентов](embed-sample-for-customers.md)

>[!div class="nextstepaction"]
>[Объекты приложения и субъекта-службы в Azure Active Directory](/azure/active-directory/develop/app-objects-and-service-principals)

>[!div class="nextstepaction"]
>[Безопасность на уровне строк с использованием локального шлюза данных с субъектом-службой](embedded-row-level-security.md#on-premises-data-gateway-with-service-principal)

>[!div class="nextstepaction"]
>[Внедрение содержимого Power BI с помощью субъект-службы и сертификата](embed-service-principal-certificate.md)