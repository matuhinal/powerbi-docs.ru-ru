---
title: Рекомендации по разработке составной модели в Power BI Desktop
description: Руководство по разработке составных моделей.
author: peter-myers
ms.reviewer: asaxton
ms.service: powerbi
ms.subservice: powerbi-desktop
ms.topic: conceptual
ms.date: 12/24/2019
ms.author: v-pemyer
ms.openlocfilehash: 528fc40427a1cb242d9154028d1a7c6617c8a14e
ms.sourcegitcommit: 0e9e211082eca7fd939803e0cd9c6b114af2f90a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2020
ms.locfileid: "83279693"
---
# <a name="composite-model-guidance-in-power-bi-desktop"></a>Рекомендации по разработке составной модели в Power BI Desktop

Эта статья предназначена для разработчиков моделей данных для составных моделей в Power BI. В ней описаны варианты использования составных моделей, а также предоставлены рекомендации по проектированию. В частности, статья поможет вам определить, подходит ли составная модель для вашего решения. Если да, тогда она также поможет при разработке оптимальной модели.

> [!NOTE]
> Общие сведения о составных моделях в этой статье не приводятся. Если вы не знакомы с составными моделями, рекомендуем сначала ознакомиться со статьей [Использование составных моделей в Power BI Desktop](../transform-model/desktop-composite-models.md).
>
> Так как составные модели содержат один или более источников DirectQuery, вы также должны иметь представление о [связях в модели](../transform-model/desktop-relationships-understand.md), [моделях DirectQuery](../connect-data/desktop-directquery-about.md) и [рекомендациях по проектированию модели](directquery-model-guidance.md).

## <a name="composite-model-use-cases"></a>Варианты использования составной модели

По возможности лучше всего разработать модель в режиме импорта. Этот режим обеспечивает наибольшую гибкость проектирования и наилучшую производительность.

Однако проблемы, связанные с большими объемами данных или составлением отчетов по данным почти в реальном времени, не могут быть решены с помощью моделей импорта. В любом случае, вы можете использовать модель DirectQuery, при условии, что ваши данные хранятся в одном источнике данных, который [поддерживается режимом DirectQuery](../connect-data/power-bi-data-sources.md).

Кроме того, вы можете рассмотреть возможность разработки составной модели в приведенных ниже ситуациях.

- Ваша модель может быть моделью DirectQuery, но вы хотите повысить производительность. В составной модели производительность можно повысить, настроив соответствующее хранилище для каждой таблицы. Вы также можете добавить [агрегаты](../transform-model/desktop-aggregations.md). Обе эти оптимизации рассматриваются далее в этой статье.
- Вы хотите объединить модель DirectQuery с дополнительными данными, которые следует импортировать в модель. Импортированные данные могут быть загружены из другого источника данных или из вычисляемых таблиц.
- Вы хотите объединить два или более источника данных DirectQuery в одну модель.

> [!NOTE]
> Составные модели не могут объединять источники активного подключения или источники аналитической базы данных DirectQuery. Источники активного подключения включают [модели с внешним размещением](../connect-data/service-datasets-understand.md#external-hosted-models) и наборы данных Power BI. К источникам аналитической базы данных DirectQuery относятся SAP Business Warehouse и SAP HANA.

## <a name="optimize-model-design"></a>Оптимизация схемы модели

Составную модель можно оптимизировать путем настройки [режимов хранения](../transform-model/desktop-storage-mode.md) таблиц и добавления [агрегатов](../transform-model/desktop-aggregations.md).

### <a name="table-storage-mode"></a>Режим хранения таблиц

В составной модели вы можете настроить режим хранения для каждой таблицы (кроме вычисляемых таблиц):

- **DirectQuery**. Мы рекомендуем вам установить этот режим для таблиц, которые представляют большие объемы данных или которые должны предоставлять результаты почти в реальном времени. Данные никогда не будут импортированы в эти таблицы. Обычно эти таблицы представляют собой таблицы фактов, то есть таблицы, используемые для формирования сводных данных.
- **Импорт**. Рекомендуем установить этот режим для таблиц измерений, то есть таблиц, используемых для фильтрации и группирования. Фактически это единственный параметр для таблиц, основанных на источниках, не поддерживаемых режимом DirectQuery. Вычисляемые таблицы всегда являются таблицами импорта.
- **Двойной**. Мы рекомендуем вам установить этот режим для таблиц измерений, когда существует вероятность, что они будут запрашиваться вместе с таблицами фактов DirectQuery из одного источника.

Существует несколько возможных сценариев, когда Power BI запрашивает составную модель:

- **Запросы только таблиц импорта или двойных таблиц**. Все данные извлекаются из кэша моделей. Это обеспечит наивысшую производительность. Этот сценарий является общим для таблиц измерений, запрашиваемых фильтрами или визуальными элементами среза.
- **Запросы двойных таблиц или таблиц DirectQuery из одного источника**. Все данные извлекаются путем отправки одного или нескольких собственных запросов к источнику DirectQuery. Это обеспечит наивысшую производительность, особенно когда в исходных таблицах существуют соответствующие индексы. Этот сценарий является общим для запросов, которые связаны с таблицами двойных измерений и таблицами фактов DirectQuery. Эти запросы являются _внутренними_, поэтому все связи "один к одному" или "один ко многим" оцениваются как [сильные](../transform-model/desktop-relationships-understand.md#strong-relationships).
- **Все остальные запросы**. Эти запросы имеют межостровные связи. Это либо потому, что таблица импорта связана с таблицей DirectQuery, либо двойная таблица связана с таблицей DirectQuery из другого источника — в этом случае она ведет себя как таблица импорта. Все связи оцениваются как [слабые](../transform-model/desktop-relationships-understand.md#weak-relationships). Это также означает, что группирования, применяемые к таблицам, отличным от DirectQuery, должны отправляться в источник DirectQuery в виде виртуальной таблицы. В этом случае собственный запрос может быть неэффективным, особенно для больших наборов группирования. Кроме того, он может предоставить конфиденциальные данные в собственном запросе.

Таким образом, следует учитывать приведенные ниже рекомендации.

- Тщательно продумайте, является ли составная модель правильным решением. Хотя она позволяет интегрировать различные источники данных на уровне модели, она также предполагает проблемы проектирования с возможными последствиями.
- Установите режим хранения **DirectQuery**, если таблица представляет собой таблицу фактов, в которой хранятся большие объемы данных, или если она должна предоставлять результаты почти в реальном времени.
- Установите для режима хранения значение **Двойной**, если таблица является таблицей измерений, и она будет запрашиваться вместе с таблицами фактов **DirectQuery** на основе того же источника.
- Настройте соответствующую частоту обновления, чтобы синхронизировать кэш модели для двойных таблиц (и любых зависимых вычисляемых таблиц) с исходными базами данных.
- Постарайтесь обеспечить целостность данных во всех источниках данных (включая кэш модели) — слабые связи исключат строки, если значения соответствующих столбцов не совпадают.
- Оптимизируйте источники данных DirectQuery с соответствующими индексами для эффективного объединения, фильтрации и группирования.
- Не загружайте конфиденциальные данные в таблицы импорта или двойные таблицы, если существует риск перехвата собственных запросов. Дополнительные сведения см. в разделе [Последствия для безопасности](../transform-model/desktop-composite-models.md#security-implications) статьи "Использование составных моделей в Power BI Desktop".

### <a name="aggregations"></a>Агрегации

Вы можете добавить агрегаты в таблицы DirectQuery в составной модели. Агрегаты кэшируются в модели, поэтому они ведут себя как таблицы импорта (хотя их нельзя использовать как таблицы модели). Их цель состоит в том, чтобы повысить производительность для запросов с более высокой детализацией. Дополнительные сведения см. в статье [Агрегаты в Power BI Desktop](../transform-model/desktop-aggregations.md).

Мы рекомендуем, чтобы таблица агрегирования следовала основному правилу: количество ее строк должно быть как минимум в 10 раз меньше, чем в базовой таблице. Например, если в базовой таблице хранится 1 миллиард строк, то в таблице агрегирования количество строк не должно превышать 100 миллионов. Это правило обеспечивает адекватный рост производительности по сравнению со стоимостью создания и обслуживания таблицы агрегирования.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения, связанные с темой этой статьи, см. в следующих ресурсах.

- [Использование составных моделей в Power BI Desktop](../transform-model/desktop-composite-models.md)
- [Связи модели в Power BI Desktop](../transform-model/desktop-relationships-understand.md)
- [Модели DirectQuery в Power BI Desktop](../connect-data/desktop-directquery-about.md)
- [Использование DirectQuery в Power BI Desktop](../connect-data/desktop-use-directquery.md)
- [Устранение неполадок с моделью DirectQuery в Power BI Desktop](../connect-data/desktop-directquery-troubleshoot.md)
- [Источники данных Power BI](../connect-data/power-bi-data-sources.md)
- [Режим хранения в Power BI Desktop](../transform-model/desktop-storage-mode.md)
- [Использование агрегатов в Power BI Desktop](../transform-model/desktop-aggregations.md)
- У вас появились вопросы? [Попробуйте задать вопрос в сообществе Power BI.](https://community.powerbi.com/)
- У вас есть предложения? [Идеи по улучшению Power BI](https://ideas.powerbi.com)
