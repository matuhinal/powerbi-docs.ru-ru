---
title: Размеры для локальных шлюзов данных
description: Руководство по работе с размерами локального шлюза данных.
author: peter-myers
ms.reviewer: asaxton
ms.service: powerbi
ms.subservice: powerbi-service
ms.topic: conceptual
ms.date: 12/30/2019
ms.author: v-pemyer
ms.openlocfilehash: 4f289bf319bf29de8f8765d55bf3400048420af5
ms.sourcegitcommit: 7aa0136f93f88516f97ddd8031ccac5d07863b92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "76829059"
---
# <a name="on-premises-data-gateway-sizing"></a>Размеры для локальных шлюзов данных

Эта статья предназначена для тех администраторов Power BI, которым требуется установить [локальный шлюз данных](../service-gateway-onprem.md) и управлять им.

Шлюз необходим каждый раз, когда Power BI требуется доступ к данным, которые недоступны непосредственно через Интернет. Его можно установить на локальном сервере или в инфраструктуре как услуге (IaaS), размещенной на виртуальной машине.

## <a name="gateway-workloads"></a>Рабочие нагрузки шлюза

Локальный шлюз данных поддерживает две рабочие нагрузки. Очень важно, чтобы вы сначала изучили эти рабочие нагрузки, прежде чем мы перейдем к размерам шлюза и другим рекомендациям.

### <a name="cached-data-workload"></a>Рабочая нагрузка кэшированных данных

Рабочая нагрузка _кэшированных данных_ извлекает и преобразует исходные данные для загрузки в наборы данных Power BI. Это выполняется за три шага:

1. **Подключение**: шлюз подключается к исходным данным.
1. **Получение и преобразование данных**: выполняется получение данных и при необходимости их преобразование. При возможности подсистема гибридных веб-приложений Power Query передает этапы преобразования в источник данных. Этот процесс называется _[свертыванием запросов](power-query-folding.md)_ . В том случае, когда это невозможно, преобразования должны выполняться шлюзом. В этом случае шлюз будет потреблять больше ресурсов ЦП и памяти.
1. **Передача**: данные передаются в службу Power BI — важно наличие надежного и быстрого подключения к Интернету, особенно для больших объемов данных.

![Диаграмма иллюстрирует локальный шлюз данных, подключающийся к локальным источникам: реляционной базе данных, книге Excel и CSV-файлам. Шлюз получает и преобразует данные.](media/gateway-onprem-sizing/gateway-onprem-workload-cached-data.png)

### <a name="live-connection-and-directquery-workloads"></a>Рабочие нагрузки для активного подключения и DirectQuery

Рабочая нагрузка для _активного подключения и DirectQuery_ работает в основном в сквозном режиме. Служба Power BI отправляет запросы, а шлюз выдает результаты запросов. Как правило, результаты запроса имеют небольшой размер.

- Дополнительные сведения об активном подключении см. в разделе [Модели с внешним размещением](../service-datasets-understand.md#external-hosted-models).
- Дополнительные сведения о DirectQuery см. в разделе [Режим DirectQuery](../service-dataset-modes-understand.md#directquery-mode).

Для этой рабочей нагрузки требуются ресурсы ЦП для запросов маршрутизации и результатов запросов. Обычно потребность в ЦП значительно меньше, чем требуется для рабочей нагрузки данных кэша, особенно когда необходимо преобразовать данные для кэширования.

Для обеспечения быстрой работы пользователей отчетов очень важно наличие надежного, быстрого и согласованного подключения.

![Диаграмма, иллюстрирующая локальный шлюз данных, подключающийся к локальным источникам: табличная и реляционная базы данных Analysis Services. В основном шлюз работает в сквозном режиме.](media/gateway-onprem-sizing/gateway-onprem-workload-liveconnection-directquery.png)

## <a name="sizing-considerations"></a>Рекомендации по выбору размера

Определение правильного размера для вашего шлюза может зависеть от приведенных ниже переменных.

- Для рабочих нагрузок данных кэша:
  - количество одновременных обновлений набора данных;
  - типы источников данных (реляционная база данных, аналитическая база данных, потоки данных или файлы);
  - объем данных, извлекаемых из источников данных;
  - любые преобразования, требуемые для работы подсистемы гибридных веб-приложений Power Query;
  - объем данных, которые будут переданы в службу Power BI.
- Для рабочих нагрузок активных подключений и DirectQuery:
  - количество одновременных пользователей отчета;
  - количество визуальных элементов на страницах отчета (каждый визуальный элемент отправляет хотя бы один запрос);
  - частота обновлений кэша запросов панели мониторинга Power BI;
  - количество отчетов в реальном времени, использующих функцию [Автоматическое обновление страницы](../desktop-automatic-page-refresh.md);
  - обеспечение [безопасности на уровне строк (RLS)](../desktop-rls.md) в наборах данных.

Как правило, для рабочих нагрузок активного подключения и DirectQuery требуется достаточно ресурсов ЦП, в то время как для рабочих нагрузок данных кэша требуется больше ресурсов ЦП и памяти. Обе рабочие нагрузки зависят от хорошей связи со службой Power BI и источниками данных.

> [!NOTE]
> Емкости Power BI накладывают ограничения на параллелизм обновления модели, а также пропускную способность активного подключения и DirectQuery. Нет смысла настраивать размер шлюзов так, чтобы они предоставляли больше возможностей, чем поддерживает служба Power BI. Ограничения отличаются по номеру SKU уровня "Премиум" (и имеют одинаковый размер SKU A). Дополнительные сведения см. в разделе [Узлы емкости](../service-premium-what-is.md#capacity-nodes) статьи "Что такое Power BI Premium?".

## <a name="recommendations"></a>Рекомендации

Рекомендации относительно размеров шлюза зависят от многих переменных. В этом разделе мы предоставляем общие рекомендации, которыми можно руководствоваться.

### <a name="initial-sizing"></a>Исходная регулировка размера

Точная оценка правильного размера может оказаться сложной задачей. Мы рекомендуем начинать с компьютера, имеющего не менее 8 ядер ЦП, 8 ГБ ОЗУ и несколько гигабитных сетевых адаптеров. Затем вы можете измерить обычную рабочую нагрузку шлюза, перейдя к счетчикам ЦП и системы памяти. Дополнительные сведения см. в статье [Monitor and optimize on-premises data gateway performance](/data-integration/gateway/service-gateway-performance) (Мониторинг и оптимизация производительности локального шлюза данных).

### <a name="connectivity"></a>Подключение

Планируйте наилучшее возможное соединение между службой Power BI и вашим шлюзом, а также шлюзом и источниками данных.

- Стремитесь достичь надежности и скорости с меньшими и согласованными задержками.
- Устраните или уменьшите количество скачков между шлюзом и источниками данных.
- Удалите все регулирования, накладываемые уровнем прокси-сервера брандмауэра. Дополнительные сведения о конечных точках Power BI см. в статье [URL-адреса Power BI для списка разрешений](../power-bi-whitelist-urls.md).
- Настройте [Azure ExpressRoute](/azure/expressroute/expressroute-introduction), чтобы установить частные управляемые подключения к Power BI.
- Для источников данных в виртуальных машинах Azure необходимо, чтобы виртуальные машины были [размещены вместе со службой Power BI](../service-admin-where-is-my-tenant-located.md).
- Обеспечьте хорошую связь между компьютером шлюза и локальной службой Active Directory для рабочих нагрузок активного подключения к SQL Server Analysis Services (SSAS), включая динамическую безопасность на уровне строк.

### <a name="clustering"></a>Кластеризация

Для крупномасштабных развертываний вы можете создать шлюз установок кластера. Кластеры избегают единых точек отказа и могут распределять нагрузку трафика между шлюзами. Вы можете выбрать один из следующих вариантов.

- Установить один или несколько шлюзов в кластере.
- Изолировать рабочие нагрузки на автономные шлюзы или кластеры серверов шлюзов.

Дополнительные сведения см. в статье [Manage on-premises data gateway high-availability clusters and load balancing](/data-integration/gateway/service-gateway-high-availability-clusters) (Управление кластерами с высоким уровнем доступности и балансировкой нагрузки для локального шлюза данных).

### <a name="dataset-design-and-settings"></a>Структура и параметры набора данных

Структура набора данных и его параметры могут повлиять на рабочие нагрузки шлюза. Чтобы снизить рабочую нагрузку шлюза, можно предпринять приведенные ниже действия.

Для наборов данных импорта:

- настройка менее частых обновлений данных;
- настройка [добавочного обновления](../service-premium-incremental-refresh.md) для сокращения количества передаваемых данных;
- по возможности обеспечение выполнения [свертывания запроса](power-query-folding.md);
- преобразование структуры в модель DirectQuery или [составную](../service-dataset-modes-understand.md#composite-mode) модель (особенно для больших объемов данных или при необходимости получения результатов с низкой задержкой).

Для наборов данных DirectQuery:

- оптимизация источников данных, модели и схем отчетов (дополнительные сведения см. в статье [Руководство по использованию модели DirectQuery в Power BI Desktop](directquery-model-guidance.md));
- создание [агрегатов](../desktop-aggregations.md) для кэширования результатов более высокого уровня, чтобы сократить количество запросов DirectQuery;
- ограничение интервалов для параметра [Автоматическое обновление страницы](../desktop-automatic-page-refresh.md) в параметрах емкости и схемах отчетов;
- ограничение частоты обновления кэша панели мониторинга (особенно когда применяется динамическая безопасность на уровне строк);
- преобразование структуры в модель импорта или [составную](../service-dataset-modes-understand.md#composite-mode) модель (особенно для небольших объемов данных или для энергонезависимых данных).

Для наборов данных активного подключения:

- ограничение частоты обновления кэша панели мониторинга (особенно когда применяется динамическая безопасность на уровне строк);

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения, связанные с темой этой статьи, см. в следующих ресурсах.

- [Guidance for deploying a data gateway for Power BI](../service-gateway-deployment-guidance.md) (Руководство по развертыванию шлюза данных для Power BI)
- [Настройка параметров прокси-сервера для локального шлюза данных](/data-integration/gateway/service-gateway-proxy)
- [Monitor and optimize on-premises data gateway performance](/data-integration/gateway/service-gateway-performance) (Мониторинг и оптимизация производительности локального шлюза данных)
- [Устранение неполадок со шлюзами — Power BI](../service-gateway-onprem-tshoot.md)
- [Устранение неполадок локального шлюза данных](/data-integration/gateway/service-gateway-tshoot)
- [Руководство по свертыванию запросов в Power BI Desktop](power-query-folding.md)
- У вас появились вопросы? [Попробуйте задать вопрос в сообществе Power BI.](https://community.powerbi.com/)
- У вас есть предложения? [Идеи по улучшению Power BI](https://ideas.powerbi.com)
