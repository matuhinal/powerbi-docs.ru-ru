---
title: Оптимизация емкостей Microsoft Power BI Premium
description: Описывает стратегии оптимизации для емкостей Power BI Premium.
author: davidiseminger
ms.author: davidi
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 04/09/2019
ms.custom: seodec18
LocalizationGroup: Premium
ms.openlocfilehash: 4d03419105244b7fddafea3b26b69e4f4f5f874c
ms.sourcegitcommit: 7aa0136f93f88516f97ddd8031ccac5d07863b92
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "79207696"
---
# <a name="optimizing-premium-capacities"></a>Оптимизация емкостей Premium

Первым подходом к решению проблем с производительностью емкости Premium является оптимизация или настройка ваших решений для восстановления приемлемого времени отклика. Основной причиной является избежание приобретения дополнительных емкостей Premium в том случае, если это не может быть оправдано.

В случае, когда требуется дополнительная емкость Premium, можно сделать следующее (эти два варианта описаны в этой статье):

- масштабировать существующую емкость Premium;
- добавить новую емкость Premium.

И наконец, в завершение этой статьи рассмотрим подходы к тестированию и изменение размера емкости Premium.

## <a name="best-practices"></a>Советы и рекомендации

Существует несколько общих рекомендаций, которые помогут вам оптимизировать потребление и производительность, включая следующие:

- Использование рабочих областей вместо личных рабочих областей.
- Разделение критических задач для бизнеса и самостоятельной бизнес-аналитики (SSBI) на разные емкости.

  ![Разделение критических важных для бизнеса задач и самостоятельной бизнес-аналитики на разные емкости.](media/service-premium-capacity-optimize/separate-capacities.png)

- Предоставление общего доступа к содержимому лишь пользователям Power BI Pro может устранить необходимость хранить это содержимое в выделенной емкости.
- Потребление выделенных емкостей для достижения определенного времени обновления или при необходимости использования определенных функций, например больших наборов данных или отчетов с разбивкой на страницы.

### <a name="addressing-common-questions"></a>Ответы на распространенные вопросы

Оптимизация развертываний Power BI Premium — сложная тема, требующая наличия знаний о требованиях к рабочей нагрузке, а также о доступных ресурсах и их эффективном использовании.

Эта статья содержит ответы на семь распространенных вопросов вместе с описанием и объяснением возможных проблем, а также сведения о способах их выявления и устранения.

### <a name="why-is-the-capacity-slow-and-what-can-i-do"></a>Почему емкость медленная? Как решить эту проблему?

Существует множество причин замедления работы емкости Premium. Для ответа на это вопрос нам необходимы дополнительные сведения, которые помогут понять, что подразумевается под "медленная". Отчеты загружаются медленно? Или во время их загрузки происходят сбои? При использовании отчетов медленно загружаются или обновляются их визуальные элементы? Обновления занимают больше времени, чем раньше или чем ожидалось?

Поняв причину проблемы, вы можете начать поиск ее решения. Ответы на следующие шесть вопросов помогут вам решить более конкретные проблемы.

### <a name="what-content-is-using-up-my-capacity"></a>Какое содержимое использует мою емкость?

Вы можете использовать приложение **Power BI Premium Capacity Metrics** для фильтрации по емкости и просмотра метрик производительности для содержимого рабочей области. Вы можете просматривать метрики производительности и использования ресурсов по часам за последние семь дней для всего содержимого, хранящегося в емкости Premium. Часто мониторинг является первым шагом, который необходимо предпринять при устранении общей проблемы с производительностью емкости Premium.

К ключевым метрикам для мониторинга относится:

- Количество случаев высокой и средней загрузки ЦП.
- Количество случаев высокой и средней загрузки памяти, а также использование памяти для определенных наборов данных, потоков данных и отчетов с разбивкой на страницы.
- Активные наборы данных, загруженные в память.
- Средняя и максимальная длительность запроса.
- Среднее время ожидания запроса.
- Среднее время обновления набора данных и потока данных.

В приложении Power BI Premium Capacity Metrics активная память отображает общий объем памяти, выделенный для отчета, который невозможно очистить, так как он используется в течение последних трех минут. Резкое увеличение времени ожидания обновления может быть связано с большим и (или) активным набором данных.

На диаграмме **Top 5 by Average Duration** (5 элементов с наибольшей средней продолжительностью выполнения запросов) выделено пять основных наборов данных, отчетов с разбивкой на страницы и потоков данных, потребляющих ресурсы емкости. Содержимое в списке пяти элементов представляет кандидаты на изучение и возможную оптимизацию.

### <a name="why-are-reports-slow"></a>Почему отчеты выполняются медленно?

В следующих таблицах описаны возможные проблемы и способы их выявления и устранения.

#### <a name="insufficient-capacity-resources"></a>Нехватка ресурсов в емкости

| Возможные объяснения | Способы определения | Способы устранения |
| --- | --- | --- |
| Высокий процент общей активной памяти (модель невозможно удалить, так как она используется в течение последних трех минут).<br><br> Несколько случаев резкого увеличения времени ожидания запроса.<br><br> Несколько случаев резкого увеличения времени ожидания обновления. | Отследите метрики памяти \[[1](#endnote-1)\] и количество вытеснений \[[2](#endnote-2)\]. | Уменьшите размер модели или перейдите на использование режима DirectQuery. См. раздел [Оптимизация моделей](#optimizing-models) в этой статье.<br><br> Увеличьте масштаб емкости.<br><br> Назначьте содержимое другой емкости. |

#### <a name="inefficient-report-designs"></a>Неэффективная разработка отчетов

| Возможные объяснения | Способы определения | Способы устранения |
| --- | --- | --- |
| Страницы отчета содержат слишком много визуальных элементов (интерактивная фильтрация может инициировать как минимум один запрос для каждого визуального элемента)<br><br> Визуальные элементы извлекают больше данных, чем необходимо. | Просмотрите схемы отчетов.<br><br> Опросите пользователей отчетов, чтобы узнать о том, как они используют отчеты.<br><br> Отследите метрики запросов к набору данных \[[3](#endnote-3)\]. | Измените отчеты, уменьшив количество визуальных элементов на странице. |

#### <a name="dataset-is-slow-especially-when-reports-have-previously-performed-well"></a>Медленная работа набора данных (особенно если ранее отчеты выполнялись с нормальной скоростью)

| Возможные объяснения | Способы определения | Способы устранения |
| --- | --- | --- |
| Увеличивающиеся объемы импорта данных.<br><br> Сложная или неэффективная логика вычислений, включая роли RLS.<br><br> Модель оптимизирована частично.<br><br> Задержка шлюза (DQ/активные подключения).<br><br> Длительное время ответа на запрос источника DQ. | Просмотрите схемы моделей.<br><br> Отследите счетчики производительности шлюза. | См. раздел [Оптимизация моделей](#optimizing-models) в этой статье. |

#### <a name="high-concurrent-report-usage"></a>Высокий коэффициент параллельного использования отчетов

| Возможные объяснения | Способы определения | Способы устранения |
| --- | --- | --- |
| Длительное время ожидания запросов.<br><br> Перегрузка ЦП.<br><br> Превышены ограничения числа подключений DQ или активных подключений. | Отследите метрики загрузки ЦП \[[4](#endnote-4)\], времени ожидания запроса и использования подключений DQ и активных подключений \[[5](#endnote-5)\], а также длительности запроса. Колебания могут указывать на проблемы с параллелизмом. | Увеличьте масштаб емкости или назначьте содержимое другой емкости.<br><br> Измените отчеты, уменьшив количество визуальных элементов на странице. |

**Примечания.**    
<a name="endnote-1"></a>\[1\] Среднее использование памяти (ГБ) и самое высокое потребление памяти (ГБ).   
<a name="endnote-2"></a>\[2\] Вытеснения наборов данных.   
<a name="endnote-3"></a>\[3\] Запросы к набору данных, среднее время выполнения запросов к набору данных (мс), количество ожиданий набора данных и среднее время ожидания набора данных (мс).   
<a name="endnote-4"></a>\[4\] Количество случаев высокой загрузки ЦП и время максимальной загрузки ЦП (за последние семь дней).   
<a name="endnote-5"></a>\[5\] Количество случаев высокой загрузки подключений DQ и активных подключений и время максимальной загрузки подключений DQ и активных подключений (за последние семь дней).   

### <a name="why-are-reports-not-loading"></a>Почему отчеты не загружаются?

Сбой загрузки отчетов является верным признаком того, что емкость перегружена и ей не хватает памяти. Такое происходит, когда все загруженные модели активны, и поэтому их невозможно удалить, а любые операции обновления были приостановлены или отложены. Служба Power BI попытается загрузить набор данных на протяжении 30 секунд, а пользователь получит уведомление о сбое с предложением повторить попытку в ближайшее время.

В настоящее время метрики для отслеживания сбоя загрузки отчетов отсутствуют. Вы можете определить потенциал этой проблемы, отслеживая системную память, в частности, максимальное потребление и время такого потребления. Высокий уровень вытеснения наборов данных и среднее время длительного обновления набора данных могут указывать на возникновение этой проблемы.

Если подобная проблема случается очень редко, нет необходимости уделять ей первоочередное внимание. Пользователи отчетов получают уведомление о том, что служба занята и что они должны повторить попытку в ближайшее время. Если подобная проблема случается слишком часто, ее можно решить, увеличив масштаб емкости Premium или назначив содержимое другой емкости.

Администраторы емкости (и администраторы службы Power BI) могут отслеживать метрику **неудачных запросов**, чтобы определить время возникновения проблемы. Кроме того, они могут перезапускать емкость, чтобы отменить выполнение всех операций в случае перегрузки системы.

### <a name="why-are-refreshes-not-starting-on-schedule"></a>Почему обновления не запускаются по расписанию?

Запланированное время запуска обновления не гарантируется. Напомним, что служба Power BI всегда будет отдавать приоритет интерактивным операциям, а не фоновым. Обновление — это фоновая операция, которая может выполняться при соблюдении двух условий:

- наличие достаточного объема памяти;
- количество поддерживаемых одновременных обновлений для емкости Premium не превышено.

В противном случае обновление ставится в очередь до тех пор, пока эти условия не будут выполнены.

Напомним, что для выполнения полного обновления требуется как минимум двойной объем текущей памяти набора данных. Если памяти недостаточно, выполнение обновления не начнется до тех пор, пока вытеснение модели не освободит память. Это приведет к задержке, которая будет длиться до тех пор, пока один или несколько наборов данных станут неактивными, после чего их можно будет удалить.

Напомним, что поддерживаемое количество максимальных одновременных обновлений в 1,5 раза превышает количество серверных виртуальных ядер, округленное в большую сторону.

Запланированное обновление не будет выполнено, если оно не сможет запуститься до выполнения следующего запланированного обновления. Прежде чем произойдет сбой, будет предпринято три попытки выполнить обновление по требованию, запускаемое вручную из пользовательского интерфейса.

Администраторы емкости (и администраторы службы Power BI) могут отслеживать метрику **среднего времени ожидания обновления (в минутах)** , чтобы определить среднюю задержку между запланированным временем и временем начала операции.

Хотя это не является приоритетной административной задачей, влияющей на своевременное обновление данных, убедитесь в наличии достаточного объема памяти. Для этого может потребоваться изоляция наборов данных в емкости с достаточным количеством ресурсов. Кроме того, возможно, что администраторы могут координировать свои действия с владельцами наборов данных, чтобы помочь откорректировать или сократить запланированное время обновления данных, минимизировав конфликты. Обратите внимание, что администратор не может просматривать очередь обновления или извлекать расписания наборов данных.

### <a name="why-are-refreshes-slow"></a>Почему обновления выполняются медленно?

Обновление может быть медленным или восприниматься как медленное (как указано в предыдущем вопросе).

Если обновление на самом деле выполняется медленно, это может быть обусловлено рядом следующих причин:

- Нехватка ресурсов ЦП (обновление может сильно загружать ЦП).
- Недостаточный объем памяти, который приводит к приостановке обновления (что требует возобновления обновления после выполнения соответствующих условий).
- Причины, не связанные с емкостью, в том числе скорость отклика системы источника данных, задержка в сети, недопустимые разрешения или пропускная способность шлюза.
- Объем данных является хорошей причиной для настройки добавочного обновления, описанного ниже.

Администраторы емкости (и администраторы службы Power BI) могут отслеживать метрику **средней длительности обновления (в минутах)** , чтобы определить тест производительности для сравнения по времени, и метрики **среднего времени ожидания обновления (в минутах)** , чтобы определить среднюю задержку между запланированным временем и временем начала операции.

Добавочное обновление может значительно сократить длительность обновления данных, особенно для больших таблиц моделей. С добавочным обновлением связаны четыре преимущества:

- **Обновления выполняются быстрее**. Только подмножество таблицы нуждается в загрузке, сокращающей загрузку ЦП и памяти, а уровень параллелизма может быть выше при обновлении нескольких секций.
- **Обновления выполняются только при необходимости**. Политики добавочного обновления можно настроить для загрузки только после изменения данных.
- **Обновление производится более надежно**. Кратковременные подключения к энергозависимым источникам данных менее подвержены отключению.
- **Модели остаются усеченными**. Политики добавочного обновления можно настроить таким образом, чтобы они автоматически удаляли историю, выходящую за пределы скользящего окна времени.

Дополнительные сведения см. в разделе [Добавочное обновление в Power BI Premium](service-premium-incremental-refresh.md).

### <a name="why-are-data-refreshes-not-completing"></a>Почему обновления данных не завершаются?

Если обновление данных запускается, но не завершается, это может быть обусловлено рядом следующих причин:

- Недостаточно памяти, даже если в емкости Premium есть только одна модель, т. е. ее размер очень большой.
- Причины, не связанные с емкостью, в том числе отключение системы источника данных, задержка в сети, недопустимые разрешения или шлюзы.

Администраторы емкости (и администраторы службы Power BI) могут отслеживать метрику **ошибок обновления по причине нехватки памяти**, чтобы определить время возникновения проблемы.

## <a name="optimizing-models"></a>Оптимизация моделей

Оптимальная разработка модели позволяет предоставить эффективное и масштабируемое решение. Тем не менее обсуждение этой темы выходит за рамки данной статьи. Вместо этого в данном разделе описаны основные области, на которые стоит обратить внимание при оптимизации моделей.

### <a name="optimizing-power-bi-hosted-models"></a>Оптимизация моделей, размещенных в службе Power BI

Оптимизация моделей, размещенных в емкости Premium, может выполняться на уровне источников данных и на уровне модели.

Рассмотрим возможности оптимизации для модели импорта:

![Возможности оптимизации для модели импорта](media/service-premium-capacity-optimize/import-model-optimizations.png)

На уровне источника данных:

- Реляционные источники данных можно оптимизировать для обеспечения максимально быстрого обновления. Для этого предварительно интегрируйте данные, примените соответствующие индексы, определите секции таблицы, которые соответствуют периодам добавочного обновления, и выполните материализацию вычислений (вместо вычисляемых таблиц и столбцов модели) или же добавьте логику вычислений в представления.
- Нереляционные источники данных можно предварительно интегрировать с реляционными хранилищами.
- Убедитесь, что шлюзы содержат достаточное количество ресурсов, предпочтительно на выделенных компьютерах с достаточной пропускной способностью и в непосредственной близости от источников данных.

На уровне модели:

- Схемы запросов Power Query могут минимизировать или удалить сложные преобразования, в первую очередь те, которые объединяют различные источники данных (для хранилищ данных это процесс выполняется на этапе извлечения, преобразования и загрузки). Убедитесь, что установлены соответствующие уровни конфиденциальности источника данных. Таким образом можно будет устранить необходимость загрузки полных результатов службой Power BI для получения комбинированного результата по запросам.
- Структура модели определяет данные для загрузки и напрямую влияет на размер модели. Ее можно разработать таким образом, чтобы избежать загрузки ненужных данных путем удаления столбцов и строк (особенно исторических данных) или загрузки сводных данных (за счет загрузки подробных данных). Достигнуть значительного уменьшения размера можно за счет удаления столбцов с большим количеством элементов (особенно текстовых столбцов), которые не очень эффективно сохраняются или сжимаются.
- Производительность запросов модели можно улучшить за счет настройки однонаправленных отношений, если нет веских причин для настройки двунаправленной фильтрации. Кроме того, рассмотрите возможность использования функции [CROSSFILTER](https://docs.microsoft.com/dax/crossfilter-function) вместо двунаправленной фильтрации.
- Таблицы агрегирования могут обеспечить быстрые ответы на запросы за счет загрузки предварительно суммированных данных, однако это увеличит размер модели и приведет к увеличению времени обновления. Как правило, таблицы агрегирования должны быть зарезервированы для очень больших моделей или составных моделей.
- Вычисляемые таблицы и столбцы увеличивают размер модели и время обновления. Как правило, меньший размер хранилища и более быстрое время обновления обеспечивается при материализации или вычислении данных в источнике данных. Если это невозможно, использование настраиваемых столбцов Power Query может улучшить сжатие хранилища.
- Вам может представиться возможность настроить выражения DAX для мер и правил RLS, к примеру переписав логику, чтобы избежать ресурсоемких формул.
- Добавочное обновление может значительно сократить время обновления и уменьшить загрузку памяти и ЦП. Кроме того, добавочное обновление можно настроить для удаления исторических данных, сохраняя размеры модели усеченными.
- При наличии различных и противоречивых шаблонов запросов вы можете изменить модель, разделив ее на две модели. Например, некоторые отчеты представляют статистические выражения высокого уровня по всей истории и могут выдерживать задержку длительностью 24 часа. Другие отчеты фокусируются на актуальных данных и требуют доступ к отдельным транзакциям. Вместо того чтобы разрабатывать одну модель для удовлетворения требований всех отчетов, создайте две модели, оптимизированные для каждого требования.

Рассмотрим возможности оптимизации для модели DirectQuery. Так как модель отправляет запросы на выполнение запросов к базовому источнику данных, оптимизация источника данных имеет решающее значение для быстрого выполнения запросов модели.

 ![Возможности оптимизации для модели DirectQuery](media/service-premium-capacity-optimize/direct-query-model-optimizations.png)

На уровне источника данных:

- Источник данных можно оптимизировать для обеспечения максимально быстрого выполнения запроса. Для этого предварительно интегрируйте данные (что невозможно на уровне модели), примените соответствующие индексы, определите секции таблицы, выполните материализацию вычислений (с индексированными представлениями) и минимизацию объема вычислений. Оптимальность работы обеспечивается, когда сквозные запросы требуют только фильтрации и установки внутренних соединений между индексированными таблицами или представлениями.
- Убедитесь, что шлюзы содержат достаточное количество ресурсов, предпочтительно на выделенных компьютерах с достаточной пропускной способностью и в непосредственной близости от источника данных.

На уровне модели:

- В схемах запросов Power Query предпочтительно не применять преобразований. В противном случае попытайтесь сократить преобразования до абсолютного минимума.
- Производительность запросов модели можно улучшить за счет настройки однонаправленных отношений, если нет веских причин для настройки двунаправленной фильтрации. Кроме того, связи модели должны быть настроены так, чтобы предполагать целостность данных (в соответствующих случаях) и способствовать созданию запросов источника данных с использованием более эффективных внутренних соединений (вместо внешних).
- Старайтесь не создавать настраиваемые столбцы запросов Power Query или вычисляемый столбец модели. Вместо этого при возможности выполняйте их материализацию в источнике данных.
- Вам может представиться возможность настроить выражения DAX для мер и правил RLS, к примеру переписав логику, чтобы избежать ресурсоемких формул.

Рассмотрим возможности оптимизации для составной модели. Напомним, что составная модель допускает сочетание таблиц импорта и DirectQuery.

![Возможности оптимизации для составной модели](media/service-premium-capacity-optimize/composite-model-optimizations.png)

- Как правило, оптимизация модели импорта и модели DirectQuery применяется к таблицам составных моделей, использующим эти же режимы хранения.
- Обеспечить сбалансированную разработку можно путем настройки таблиц измерений (представляющих собой бизнес-сущности) в качестве двойного режима хранения и таблиц фактов (часто больших таблиц, представляющих собой рабочие факты) в качестве режима хранения DirectQuery. Режим двойного хранения объединяет режим импорта и режим DirectQuery, позволяя службе Power BI определять наиболее эффективный режим хранения при создании машинного запроса для сквозной передачи.
- Убедитесь, что шлюзы содержат достаточное количество ресурсов, предпочтительно на выделенных компьютерах с достаточной пропускной способностью и в непосредственной близости от источников данных.
- Таблицы агрегирования, для которых настроен режим импорта, могут значительно повысить производительность запросов при суммировании таблиц фактов в режиме хранения DirectQuery. При этом таблицы агрегирования увеличат размер модели и время обновления. Часто это является приемлемым компромиссом для более быстрых запросов.

### <a name="optimizing-externally-hosted-models"></a>Оптимизация внешних моделей

Многие возможности оптимизации, описанные в разделе [Оптимизация моделей, размещенных в службе Power BI](#optimizing-power-bi-hosted-models), применимы также к моделям, разработанным с помощью служб Azure Analysis Services и SQL Server Analysis Services. Очевидными исключениями являются некоторые функции, которые в настоящее время не поддерживаются, а также составные модели и таблицы агрегирования.

Рассматривая внешние наборы данных, необходимо уделить дополнительное внимание размещению базы данных по отношению к службе Power BI. Для служб Azure Analysis Services это означает создание ресурса Azure в регионе клиента Power BI (домашнем регионе). Для служб SQL Server Analysis Services (для IaaS) это означает размещение виртуальной машины в одном регионе, а для локальных служб — обеспечение эффективной настройки шлюза.

Кроме того, интересно отметить, что базы данных Azure Analysis Services и табличные базы данных SQL Server Analysis Services требуют, чтобы их модели были полностью загружены в память и чтобы они всегда оставались там для поддержки выполнения запросов. Как и в случае службы Power BI, для выполнения обновления необходим достаточный объем памяти, если модель должна оставаться подключенной во время обновления. В отличие от службы Power BI, в рамках решения Power BI Premium не существует концепции, согласно которой модели автоматически устаревают в памяти и вне ее в зависимости от использования. Таким образом, Power BI Premium предлагает более эффективный подход для максимизации запросов к моделям с меньшей загрузкой памяти.

## <a name="capacity-planning"></a>Планирование емкостей

Размер емкости Premium определяет объем доступной памяти и ресурсы процессора, а также пределы, устанавливаемые для емкости. Количество емкостей Premium также принимается во внимание, так как создание нескольких емкостей Premium может изолировать рабочие нагрузки друг от друга. Обратите внимание, что объем хранилища составляет 100 ТБ на узел емкости, и этого, вероятно, будет более чем достаточно для любой рабочей нагрузки.

Определение размера и количества емкостей Premium может быть сложной задачей, особенно для начальных емкостей. При определении размера емкости в первую очередь нужно разобраться со средней рабочей нагрузкой, представляющей ожидаемое ежедневное использование. Важно понимать, что не все рабочие нагрузки одинаковы. Например, с одной стороны, ситуацию со 100 пользователями, одновременно получающими доступ к одной странице отчета, содержащей один визуальный элемент, легко реализовать. Но с другой стороны, в ситуации со 100 пользователями, одновременно получающими доступ к 100 различным отчетам, каждый из которых содержит 100 визуальных элементов на странице отчета, к ресурсам емкости будут предъявлены совершенно другие требования.

Поэтому администраторам емкости необходимо учитывать множество факторов, специфичных для вашей среды, содержимого и ожидаемого использования. Основная задача — максимизировать потребление емкости, обеспечивая согласованное время запросов, приемлемое время ожидания и частоту вытеснения. К упомянутым выше факторам относятся:

- **Размер модели и характеристики данных**. Импортируемые модели должны быть полностью загружены в память, чтобы их можно было запрашивать или обновлять. Наборам данных активных подключений и DQ может потребоваться значительная загруженность процессора, а также, возможно, значительный объем памяти для оценки сложных мер или правил RLS. Объем памяти и размер процессора, а также пропускная способность запросов активных подключений и DQ ограничены размером емкости.
- **Одновременно активные модели**. Одновременный запрос различных моделей импорта обеспечит лучшую скорость отклика и повысит производительность, если модели останутся в памяти. Для размещения всех моделей с большим количеством запросов необходим достаточный объем памяти. Кроме того, для их обновления потребуется дополнительная память.
- **Обновление модели импорта**. Тип обновления (полное или добавочное), длительность и сложность запросов Power Query, а также логика вычисляемых таблиц и столбцов могут влиять на память и особенно на загрузку процессора. Одновременные обновления ограничены размером емкости (в 1,5 раза больше количества серверных виртуальных ядер, округленного в большую сторону).
- **Одновременные запросы**. Большое количество одновременных запросов может привести к отсутствию ответа на отчеты, если число подключений процессора либо активных подключений или подключений DQ превысит предел емкости. В первую очередь это касается страниц отчетов, которые содержат большое количество визуальных элементов.
- **Потоки данных и отчеты с разбивкой на страницы**. Можно настроить емкость для поддержки потоков данных и отчетов с разбивкой на страницы. Для каждого из них потребуется настраиваемый максимальный процент памяти емкости. Память выделяется динамически для потоков данных, но статически для отчетов с разбивкой на страницы.

В дополнение к этим факторам администраторы емкости могут рассмотреть возможность создания нескольких емкостей. Большое количество емкостей позволяет изолировать рабочие нагрузки. Их можно настроить для обеспечения гарантированных ресурсов приоритетным рабочим нагрузкам. Например, можно создать две емкости, чтобы отделить критически важные для бизнеса рабочие нагрузки от рабочих нагрузок самостоятельной бизнес-аналитики. Критически важную для бизнеса емкость можно использовать для изоляции больших корпоративных моделей, обеспечивая их гарантированными ресурсами. При этом доступ для создания предоставляется только ИТ-отделу. Емкость самостоятельной бизнес-аналитики можно использовать для размещения возрастающего количества небольших моделей с доступом, предоставляемым бизнес-аналитикам. Время от времени емкость самостоятельной бизнес-аналитики может испытывать допустимые задержки в выполнении запросов или обновлений.

Со временем администраторы емкости смогут балансировать рабочие области между емкостями, перемещая содержимое между рабочими областями или рабочие области между емкостями, а также увеличивая или уменьшая масштаб емкости. Как правило, для размещения более крупных моделей необходимо осуществить вертикальное масштабирование, а для большего параллелизма — горизонтальное.

Напомним, что при приобретении лицензии для клиента предоставляются виртуальные ядра. Приобретение подписки **P3** позволит создать от одной до четырех емкостей Premium, то есть 1 в P3, 2 в P2 или 4 в P1. Кроме того, перед преобразованием емкости P2 в емкость P3 можно разделить виртуальные ядра для создания двух емкостей P1.

## <a name="testing-approaches"></a>Подходы к тестированию

После определения размера емкости можно выполнить тестирование путем создания контролируемой среды. Практическим и экономичным вариантом является создание емкости Azure (SKU A) с учетом того, что размер емкости P1 соответствует размеру емкости A4, а размер емкостей P2 и P3 соответствуют размеру емкостей A5 и A6. Емкости Azure можно создавать достаточно быстро. Они оплачиваются на почасовой основе. Таким образом, после завершения тестирования их можно легко удалить, чтобы остановить накопление издержек.

Содержимое теста можно добавить в рабочие области, созданные в емкости Azure, а затем отдельные пользователи могут запускать отчеты для создания реалистичной и репрезентативной рабочей нагрузки запросов. В случае использования моделей импорта необходимо выполнить обновление каждой модели. Затем с помощью инструментов мониторинга можно просмотреть все метрики, чтобы получить сведения о потреблении ресурсов.

Важно, чтобы тесты были повторяемыми. Тесты должны выполняться несколько раз, и каждый раз они должны иметь примерно одинаковый результат. Среднее значение по этим результатам можно использовать для экстраполяции и оценки рабочей нагрузки в реальных рабочих условиях.

Если у вас уже есть емкость и отчеты, для которых требуется выполнить нагрузочный тест, используйте [средство формирования нагрузки PowerShell](https://aka.ms/PowerBILoadTestingTool) для быстрого создания нагрузочного теста. Это средство позволяет оценить, сколько экземпляров каждого отчета ваша емкость может выполнять в течение часа. С помощью него можно оценить способность емкости к отрисовке отдельного отчета или параллельной отрисовке нескольких разных отчетов. Дополнительные сведения см. в видеоролике о [емкости Premium в Microsoft Power BI](https://www.youtube.com/watch?time_continue=1860&v=C6vk6wk9dcw).

Чтобы создать более сложный тест, разработайте приложение нагрузочного тестирования для имитации реалистичной рабочей нагрузки. Дополнительные сведения см. в вебинаре [Load Testing Power BI Applications with Visual Studio Load Test](https://powerbi.microsoft.com/blog/week-4-11-webinars-load-testing-power-bi-applications-with-visual-studio-load-test-and-getting-started-with-cds-for-apps-based-model-driven-apps/) (Нагрузочное тестирование приложений Power BI с использованием нагрузочного теста Visual Studio).

## <a name="acknowledgements"></a>Благодарности

Эта статья была написана Питером Майерсом (Peter Myers), MVP-специалистом по платформам данных и независимым экспертом в области бизнес-аналитики в [Bitwise Solutions](https://www.bitwisesolutions.com.au/).

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Сценарии использования емкостей Premium](service-premium-capacity-scenarios.md)   
  
Появились дополнительные вопросы? [Попробуйте задать вопрос в сообществе Power BI.](https://community.powerbi.com/)