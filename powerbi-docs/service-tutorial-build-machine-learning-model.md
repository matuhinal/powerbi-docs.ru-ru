---
title: Руководство. Создание модели машинного обучения в Power BI (предварительная версия)
description: В рамках этого руководства вы создадите в Power BI модель машинного обучения.
author: davidiseminger
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-service
ms.custom: connect-to-services
ms.topic: tutorial
ms.date: 03/29/2019
ms.author: davidi
LocalizationGroup: Connect to services
ms.openlocfilehash: 611d6f6c923e6cb68af94840c4266a0b6dee7651
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "61407197"
---
# <a name="tutorial-build-a-machine-learning-model-in-power-bi-preview"></a>Руководство. Создание модели машинного обучения в Power BI (предварительная версия)

В рамках этой учебной статьи **автоматизированное машинное обучение** используется для создания и применения модели двоичного прогнозирования с помощью Power BI. Это руководство содержит рекомендации по созданию потока данных Power BI, а также обучению и проверке модели машинного обучения непосредственно в Power BI с использованием сущностей, которые определяются в потоке данных. Затем эта модель применяется при оценке, чтобы создать прогнозы.

Сначала вы создадите модель машинного обучения для двоичного прогнозирования намерений сетевых покупателей по набору атрибутов их сеанса подключения. В этом упражнении используется оценочный набор данных машинного обучения. После обучения модели в Power BI автоматически создается отчет о проверке с объяснением результатов модели. Вы сможете просмотреть отчет о проверке и применить модель к данным для оценки.

В этом руководстве рассматриваются следующие этапы:

> [!div class="checklist"]
> * создание потока данных с входными данными;
> * создание и обучение модели машинного обучения;
> * просмотр отчета о проверке модели;
> * применение модели к сущности потока данных;
> * использование результатов оценки модели в отчете Power BI.

## <a name="create-a-dataflow-with-the-input-data"></a>Создание потока данных с входными данными

Первая часть этого руководства посвящена созданию потока данных с входными данными. Этот процесс разделен на несколько этапов, которые описаны в следующих разделах, начиная с получения данных.

### <a name="get-data"></a>Получить данные

Первый этап при создании потока данных — подготовка источника данных. В нашем примере используется набор данных машинного обучения с информацией о нескольких сеансах подключения, часть из которых привела к покупке. Этот набор данных содержит набор атрибутов для этих сеансов, который мы применим для обучения нашей модели.

Набор данных можно скачать на веб-сайте UC Irvine.  Мы сохранили его копию для работы с этим руководством по следующей ссылке: [online_shoppers_intention.csv](https://raw.githubusercontent.com/santoshc1/PowerBI-AI-samples/master/Tutorial_AutomatedML/online_shoppers_intention.csv).

### <a name="create-the-entities"></a>Создание сущностей

Чтобы создать сущности в потоке данных, войдите в службу Power BI и перейдите в вашей выделенной емкости к рабочей области, в которой включена предварительная версия функции ИИ.

Если у вас нет рабочей области, можно создать ее. Для этого выберите **Рабочие области** в меню навигации слева и щелкните **Создать рабочую область приложения** в нижней части появившейся панели. Справа откроется панель для ввода сведений о рабочей области. Введите имя рабочей области и щелкните **Расширенный**. Убедитесь, что для рабочей области выбрана выделенная емкость на соответствующем переключателе и для ее выделенного экземпляра емкости включена предварительная версия решения ИИ. Затем выберите **Сохранить**.

![Создать рабочую область](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-01.png)

После создания рабочей области можно щелкнуть **Пропустить** в нижнем правом углу экрана приветствия, как показано на приведенном ниже изображении.

![Пропуск при наличии рабочей области](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-02.png)

Выберите вкладку **Потоки данных (предварительная версия)**. Нажмите кнопку **Создать** в верхней части рабочей области справа, а затем выберите **Поток данных**.

![Создание потока данных](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-03.png)

Выберите **Добавить новые сущности**. В браузере откроется редактор **Power Query**.

![Добавление новой сущности](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-04.png)

В качестве источника данных выберите **Text/CSV File** (Текстовый файл или файл CSV), как показано на приведенном далее изображении.

![Выбран вариант "Текстовый файл или файл CSV"](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-05.png)

После этого откроется диалоговое окно **Соединение с источником данных**, в котором нужно вставить ссылку на файл *online_shoppers_intention.csv* в область **File path or URL** (Файл или URL-адрес), а затем щелкнуть **Далее**.

`https://raw.githubusercontent.com/santoshc1/PowerBI-AI-samples/master/Tutorial_AutomatedML/online_shoppers_intention.csv`

![Путь к файлу](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-06.png)

В редакторе Power Query отобразятся данные из CSV-файла в режиме предварительного просмотра. На ленте команд щелкните **Преобразовать таблицу**, а в открывшемся меню выберите **Использовать первую строку в качестве заголовков**. После этого на панель **Примененные шаги** справа будет добавлен шаг выполнения запроса _Повышенные заголовки_. Вы можете присвоить запросу более понятное имя, изменив значение в поле **Имя** на правой панели. Например, укажите имя запроса _Online Visitor_ (Веб-посетитель).

![Присвоение понятного имени](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-07.png)

В этом наборе данных у некоторых атрибутов _числовой_ или _логический_ тип данных, которые **Power Query** может воспринимать как строковые значения. Выберите значок типа атрибута в верхней части заголовка каждого столбца, чтобы изменить типы для указанных ниже столбцов:

* **Десятичное число:** Administrative_Duration; Informational_Duration; ProductRelated_Duration; BounceRates; ExitRates; PageValues; SpecialDay.
* **Истина или ложь:** Weekend; Revenue.

![Изменение типа данных](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-08.png)

Для модели **двоичного прогнозирования**, которую мы будем обучать, требуется логическое поле в качестве метки для результатов предыдущих наблюдений. В этом наборе данных атрибут _Revenue_ подтверждает совершенную покупку, и он уже доступен как логическое значение. Это позволяет не добавлять вычисляемый столбец для метки. Для других наборов данных, возможно, придется преобразовать существующие атрибуты метки в логический столбец.

Нажмите кнопку **Готово**, чтобы закрыть редактор Power Query. Откроется список сущностей с добавленными данными о _веб-посетителях_. Выберите **Сохранить** в верхнем углу справа, укажите имя для потока данных и нажмите кнопку **Сохранить** в диалоговом окне, как показано на приведенном ниже изображении.

![Сохранение потока данных](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-09.png)

### <a name="refresh-the-dataflow"></a>Обновление потока данных

После сохранения потока данных отобразится уведомление об успешном выполнении операции. Щелкните **Обновить сейчас**, чтобы принять данные из источника в поток данных.

![Обновить сейчас](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-10.png)

Нажмите **Закрыть** в верхнем углу справа и дождитесь, пока завершится обновление потока данных.

Кроме того, вы можете обновить поток данных с помощью команд **Действия**. Когда обновление завершится, для потока данных отобразится метка времени.

![Метка времени обновления](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-11.png)

## <a name="create-and-train-a-machine-learning-model"></a>Создание и обучение модели машинного обучения

Когда обновление завершится, выберите поток данных. Чтобы добавить модель машинного обучения, нажмите кнопку **Применить модель ML** в списке **Действия** для базовой сущности, которая содержит обучающие данные и сведения о метках. Затем щелкните **Добавить модель машинного обучения**.

![Добавить модель машинного обучения](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-12.png)

Первый ша при создании модели машинного обучения — настройка исторических данных, которые содержат поле с прогнозируемой меткой. Модель создается путем обучения на основе этих данных.

В наборе данных из нашего примера меткой является поле **Revenue**. Выберите **Revenue** в разделе "Поле исторического результата" и щелкните **Далее**.

![Выбор исторических данных](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-13.png)

После этого нужно выбрать тип для создаваемой модели машинного обучения. Power BI анализирует значения в указанном поле исторического результата и предлагает типы моделей машинного обучения, которые позволяют прогнозировать такое поле.

В нашем примере прогнозируется двоичный результат (будет пользователь делать покупку или нет), поэтому выберите тип модели **Двоичное прогнозирование** и щелкните "Далее".

![Выбор двоичного прогнозирования](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-14.png)

Затем Power BI выполняет предварительное сканирование данных и предлагает входные данные, которые может использовать модель. Вы можете настроить поля ввода, используемые для модели. В очищенном наборе данных из нашего примера можно выбрать все поля, установив флажок рядом с именем сущности. Щелкните **Далее**, чтобы подтвердить входные данные.

![Выбор флажка "Далее"](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-15.png)

На последнем этапе нам нужно указать имя для модели и понятные метки для результатов, которые будут использоваться в автоматически создаваемом отчете с результатами проверки модели. Здесь мы присвоим модели имя _Purchase Intent Prediction_, а для значений true и false укажем метки _Purchase_ и _No-Purchase_. Затем выберите **Сохранить**.

![Сохранение модели](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-16.png)

Теперь модель машинного обучения готова к обучению. Щелкните **Обновить сейчас**, чтобы начать обучение модели.

![Обновить сейчас](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-17.png)

Обучение начинается с выборки и нормализации исторических данных, а также разбиения набора данных на две новые сущности: *Purchase Intent Prediction Training Data* (Обучающие данные для прогнозирования намерения покупки) и *Purchase Intent Prediction Testing Data* (Тестовые данные для прогнозирования намерения покупки).

В зависимости от размера набора данных обучение может занять от нескольких минут до нескольких часов. На этом этапе модель отображается на вкладке **Модели машинного обучения** для потока данных. Состояние _Ready_ (Готова) указывает, что модель поставлена в очередь для обучения или находится в процессе обучения.

![Готовность к обучению](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-18.png)

Пока модель обучается, вы не сможете просматривать и изменять поток данных. Завершение обучения и проверки модели можно отследить по состоянию потока данных. В рабочей области на вкладке **Потоки данных** для него отображается значение "Выполняется обновление".

![Выполняется обновление](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-19.png)

Когда завершится обучение модели, для потока данных отобразится новое время обновления. Вы можете убедиться, что модель обучена, открыв вкладку **Модели машинного обучения** в потоке данных. Для созданной модели должно отображаться состояние **Обучена** и свежее время в поле **Последнее обучение**.

![Последнее обучение](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-20.png)

## <a name="review-the-model-validation-report"></a>Просмотр отчета о проверке модели

Чтобы просмотреть отчет о проверке модели, на вкладке **Модели машинного обучения** нажмите кнопку **Просмотр отчета о производительности и применение модели** в столбце **Действия** для новой модели. В этом отчете описано ожидаемое поведение модели машинного обучения.

На странице отчета **Производительность модели** выберите элемент **Ключевые факторы влияния**, чтобы просмотреть самые важные прогностические факторы для этой модели. Вы можете выбрать любой фактор, чтобы узнать, как с ним связано распределение результатов.

![Производительность модели](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-21.png)

С помощью среза **Порог вероятности** на странице "Эффективность модели" вы можете изучить влияние порога на точность и полноту результатов модели.

![Порог вероятности](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-22.png)

На других страницах отчета представлены статистические показатели эффективности для модели.

Отчет также содержит страницу с подробными сведениями об обучении: параметры выполненных итераций, методы извлечения компонентов из входных данных, гиперпараметры в итоговой модели.

## <a name="apply-the-model-to-a-dataflow-entity"></a>Применение модели к сущности потока данных

Нажмите кнопку **Применить модель** в верхней части отчета, чтобы эта модель вызывалась при обновлении потока данных. В диалоговом окне **Применить** вы можете указать целевой объект с исходными данными, к которым нужно применить эту модель.

![Применить модель](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-23.png)

Чтобы просмотреть результаты в редакторе запросов, щелкните действие **Обновить** для потока данных в соответствующем запросе.

При применении модели будет создана новая сущность с именем, составленным из суффикса **enriched <имя_модели>** и имени сущности, к которой была применена модель. В нашем примере модель применяется к сущности **OnlineShoppers**, после чего создается новая сущность **OnlineShoppers enriched Purchase Intent Prediction** с результатами прогнозирования, полученными от модели.

При применении модели двоичного прогнозирования добавляются три столбца с прогнозируемым результатом, оценкой вероятности и основными факторами влияния на прогноз для конкретной записи. Имя каждого из них дополняется указанным префиксом имени столбца.

![Три столбца с результатами](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-24.png)

Есть известная проблема: выходные столбцы с результатами оценки в расширенной сущности доступны только из Power BI Desktop. Чтобы просмотреть эти данные в службе, придется использовать специальную сущность для просмотра.

После обновления потока данных вы сможете выбрать сущность **OnlineShoppers enriched Purchase Intent Prediction Preview** для просмотра результатов.

![Просмотр результатов](media/service-tutorial-build-machine-learning-model/tutorial-build-machine-learning-model-25.png)

## <a name="using-the-scored-output-from-the-model-in-a-power-bi-report"></a>Использование результатов оценки модели в отчете Power BI

Чтобы использовать выходные данные с результатами работы модели машинного обучения, можно подключиться к потоку данных из Power BI Desktop через соединитель потоков данных (Dataflows). После этого вы сможете применить сущность **OnlineShoppers enriched Purchase Intent Prediction** для включения прогнозов модели в отчеты Power BI.

## <a name="next-steps"></a>Дальнейшие действия

В рамках этого руководства вы создали и применили модель двоичного прогнозирования в Power BI, выполнив следующие действия:

* создание потока данных с входными данными;
* создание и обучение модели машинного обучения;
* просмотр отчета о проверке модели;
* применение модели к сущности потока данных;
* использование результатов оценки модели в отчете Power BI.

Дополнительные сведения см. в статье [Automated Machine Learning in Power BI (Preview)](service-machine-learning-automated.md) (Автоматизированное Машинное обучение в Power BI (предварительная версия)).
