---
title: Создание и использование потоков данных в Power BI
description: Сведения о создании и использовании потоков данных в Power BI
author: davidiseminger
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-service
ms.topic: how-to
ms.date: 01/15/2020
ms.author: davidi
LocalizationGroup: Data from files
ms.openlocfilehash: fd0f9db041fb4862831630249e847c63572263b0
ms.sourcegitcommit: eef4eee24695570ae3186b4d8d99660df16bf54c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/23/2020
ms.locfileid: "85240255"
---
# <a name="creating-and-using-dataflows-in-power-bi"></a>Создание и использование потоков данных в Power BI

С помощью расширенной подготовки данных в **Power BI** можно создать коллекцию данных, которая называется потоком данных, а затем с ее помощью подключиться к бизнес-данным из разных источников, очистить и преобразовать эти данные, а затем загрузить их в хранилище Power BI.

**Поток данных** — это коллекция *сущностей* (сущности здесь аналогичны таблицам), которые создаются и администрируются в рабочих областях в службе Power BI. Вы можно добавлять и изменять сущности в потоке данных, а также управлять расписаниями обновления данных непосредственно из рабочей области, в которой был создан поток данных.

Создав поток данных с помощью**Power BI Desktop** и **службы Power BI**, вы можете создавать наборы данных, отчеты, панели мониторинга и приложения на основе данных из потоков данных Power BI. Это позволит вам получить ценные аналитические сведения о вашей коммерческой деятельности.

![Использование потоков данных в Power BI](media/service-dataflows-create-use/dataflows-create-use_01a.png)

Для работы с потоком данных нужно выполнить три шага:

1. Создание потока данных с помощью специально разработанных средств Майкрософт.
2. Настройка расписания обновления для данных, которые вы хотите включить в поток данных.
3. Создание набора данных на основе этого потока данных с помощью Power BI Desktop. 

В следующих разделах мы рассмотрим каждый из этих шагов и средства, которые предоставляются для их выполнения. Давайте приступим.

## <a name="creating-a-dataflow"></a>Создание потока данных
Чтобы создать поток данных, запустите службу Power BI в браузере и в области навигации слева выберите **рабочую область** (потоки данных недоступны в разделе *my-workspace* в службе Power BI), как показано на следующем экране. Вы также можете создать рабочую область для создания потока данных. 

![Создание потока данных в Power BI](media/service-dataflows-create-use/dataflows-create-use_02a.png)

Перейдя в **рабочую область**, где вы можете создать поток данных, вы увидите кнопку **+Создать** в правом верхнем углу холста. Нажмите эту кнопку **+Создать** и выберите **Поток данных** в раскрывающемся списке. 

Помните, что у каждого потока данных есть только *один владелец* — это создавший его пользователь. Только владелец может изменить поток данных. Все члены **рабочей области** с правами на чтение или запись в рабочей области, в которой был создан поток данных, могут подключаться к потоку данных через **Power BI Desktop**, как описано далее в этой статье.

![Кнопка "+Создать" в службе Power BI, позволяющая создать поток данных](media/service-dataflows-create-use/dataflows-create-use_03a.png)

Здесь вы можете добавить **сущности**, которые мы подробнее рассмотрим в следующем разделе.

![Добавление сущностей в поток данных](media/service-dataflows-create-use/dataflows-create-use_04a.png)

### <a name="add-entities"></a>Добавление сущностей

**Сущность** — это набор полей, используемых для хранения данных, аналогично таблице в базе данных. На следующем рисунке показано несколько источников данных, из которых можно принимать данные в Power BI.

![Выбор источников данных для добавления сущностей](media/service-dataflows-create-use/dataflows-create-use_05a.png)

При выборе источника данных вам нужно указать параметры подключения, в том числе учетную запись для подключения к источнику данных, как показано на следующем рисунке.

![Подключиться к источнику данных](media/service-dataflows-create-use/dataflows-create-use_06.png)

Подключившись, вы сможете выбрать данные, используемые для сущности. Когда вы выберете данные и источник, Power BI будет повторно подключаться к этому источнику для обновления данных в потоке данных с частотой, которую вы настроите позже.

![Выбора данных, используемых для сущности](media/service-dataflows-create-use/dataflows-create-use_07.png)

Выбрав данные для использования в сущности, вы сможете с помощью редактора потока данных изменить их формат для использования с потоком данных.

### <a name="using-the-dataflow-editor"></a>Использование редактора потока данных

Выбрав данные из источника для использования в сущности, вы сможете изменить формат выбранных данных в соответствии с требованиями к созданной сущности, используя возможности редактирования Power Query, аналогичные функциям **редактора Power Query** в  **Power BI Desktop**. См. дополнительные сведения о [Power Query (Power Query входит в состав Power BI Desktop как редактор Power Query)](desktop-query-overview.md) для Power BI Desktop. 

Если вы хотите просмотреть код, который создает запрос в каждом действии, или нужно создать собственный формирующий код, можно использовать **расширенный редактор**. 

![Использование расширенного редактора](media/service-dataflows-create-use/dataflows-create-use_07b.png)

### <a name="dataflows-and-the-common-data-model-cdm"></a>Потоки данных и общая модель данных (CDM)

В число сущностей потоков данных входят новые средства, которые позволяют легко сопоставлять бизнес-данные с CDM (стандартизованной схемой от корпорации Майкрософт), дополнять ее данными от корпорации Майкрософт и сторонних поставщиков, а также получать упрощенный доступ к машинному обучению. Эти новые возможности позволяют получить ценные сведения и практические рекомендации на основе бизнес-данных. Завершив все необходимые преобразования на этапе изменения запросов, вы сможете сопоставить столбцы из таблиц источника данных с полями стандартной сущности, которая определена в CDM. Для стандартных сущностей используется известная схема, определенная в CDM.

См. дополнительные сведения в статье [Что такое модель общих данных?](https://docs.microsoft.com/powerapps/common-data-model/overview)

Чтобы применить CDM для потока данных, в диалоговом окне **Изменение запросов** щелкните команду **Map to Standard** (Сопоставить со стандартной) для преобразования. Откроется экран **Сопоставление сущностей**, где вы можете выбрать стандартную сущность для сопоставления.

![Сопоставление со стандартной сущностью](media/service-dataflows-create-use/dataflows-create-use_08.png)

При сопоставлении исходного столбца со стандартным полем происходит следующее:

1. Исходный столбец принимает имя стандартного поля (если эти имена не совпадают, имя столбца изменяется).
2. Столбцу источника присваивается стандартный тип поля данных.

Чтобы сохранить стандартную сущность Map to Standard, всем несопоставленным стандартным полям присваиваются значения *Null*.

Все несопоставленные столбцы источника сохраняются неизменными, чтобы в результате сопоставления получить стандартную сущность с пользовательскими полями.

Когда вы завершите выбор параметров, то есть сущность и все параметры данных будут готовы к сохранению, выберите в меню команду **Сохранить**. Обратите внимание, что вы можете создать несколько сущностей с помощью кнопки **Добавить сущности**. Кроме того, вы можете уточнить запросы и параметры для созданных сущностей с помощью функции изменения сущности.

![Сохранение сопоставления сущностей](media/service-dataflows-create-use/dataflows-create-use_09.png)

Когда вы нажмете **Сохранить**, вам будет предложено присвоить потоку данных имя и описание.

![Имя и описание для нового потока данных](media/service-dataflows-create-use/dataflows-create-use_10.png)

Завершив эти изменения и нажав кнопку **Сохранить**, вы увидите новое окно с сообщением о создании **потока данных**. 

![Поток данных успешно сохранен](media/service-dataflows-create-use/dataflows-create-use_11.png)

Итак, теперь все готово для следующего шага, на котором вы настроите частоту обновления источников данных.

## <a name="schedule-the-refresh-frequency"></a>Настройка частоты обновления

Сохранив поток данных, вам нужно настроить расписание обновления для каждого из подключенных источников данных.

Потоки данных Power BI используют процесс обновления данных Power BI для поддержания актуальности данных. В **службе Power BI** в разделе **рабочей области** есть несколько областей, где могут отображаться данные, в том числе потоки данных, как показано на следующем рисунке.

![Управление потоками данных в службе Power BI](media/service-dataflows-create-use/dataflows-create-use_12.png)

Элемент *Поток данных Dynamics*, который мы видели на предыдущем рисунке — это тот самый поток данных, который мы создали в предыдущем разделе. Чтобы настроить обновление, выберите значок **Расписание обновлений** в области **Действия**, как показано на следующем рисунке. 

![Кнопка "Расписание обновлений" в разделе "Действия"](media/service-dataflows-create-use/dataflows-create-use_13.png)

Щелкнув значок **Расписание обновлений**, вы перейдете на панель **Расписание обновлений**, которая позволяет задать частоту и время обновления для потока данных.

![Параметры расписания обновлений](media/service-dataflows-create-use/dataflows-create-use_14.png)

Дополнительные сведения вы найдете в статье [о настройке обновления по расписанию](../connect-data/refresh-scheduled-refresh.md) с описанием алгоритма обновления наборов данных в Power BI. Для потоков данных используется только та же логика и те же параметры обновления, что и для наборов данных Power BI. 


## <a name="connect-to-your-dataflow-in-power-bi-desktop"></a>Подключение к потокам данных из Power BI Desktop

Завершив создание потока данных и настроив частоту обновления для каждого источника данных, которые используются для заполнения модели, вы сможете перейти к последнему (третьему) шагу, на котором мы подключимся к потоку данных из **Power BI Desktop**. 

Чтобы подключиться к потоку данных, выберите в Power BI Desktop элементы **Получить данные > Power BI > Потоки данных Power BI (бета-версия)** , как показано на следующем рисунке.

![Подключение к потокам данных из Power BI Desktop](media/service-dataflows-create-use/dataflows-create-use_15.png)

Отсюда перейдите к **рабочей области**, в которой ранее сохранили поток данных, затем выберите из списка поток данных и созданные сущности.

Можно также использовать **панель поиска** в верхней части окна, чтобы быстро найти имя потока данных или сущностей среди множества представленных здесь сущностей.

Когда вы выберете сущность и нажмете кнопку **Загрузить**, сущности отобразятся на панели **Поля** в **Power BI Desktop**. По виду и функциям они ничем не отличаются от **таблиц** из любого другого набора данных.

## <a name="using-dataflows-stored-in-azure-data-lake-storage-gen2"></a>Использование потоков данных, хранящихся в Azure Data Lake Storage 2-го поколения

Некоторым организациях может потребоваться использовать собственные хранилища для создания потоков данных и управления ими. Вы можете интегрировать потоки данных с Azure Data Lake Storage 2-го поколения, если соблюдать требования и правильно управлять разрешениями. Доступна документация по всем требованиям для такого подхода, начиная с обзорного документа [о потоках данных и интеграции Azure Data Lake (предварительная версия)](service-dataflows-azure-data-lake-integration.md).


## <a name="troubleshooting-data-connections"></a>Устранение неполадок при подключении к данным

Иногда при подключении к источникам данных для потоков данных могут возникать проблемы. Этот раздел содержит советы по устранению неполадок при возникновении таких проблем. 

* **Соединитель SalesForce** — использование пробной учетной записи Salesforce с потоками данных приводит к сбою подключения без каких-либо сообщений. Чтобы устранить эту проблему, используйте рабочую учетную запись Salesforce или учетную запись разработчика для тестирования.

* **Соединитель SharePoint** — обязательно указывайте корневой адрес сайта SharePoint, но не вложенные папки или документы. Правильная ссылка должна иметь такой формат: `https://microsoft.sharepoint.com/teams/ObjectModel/`. 

* **Соединитель файлов JSON** — сейчас вы можете подключиться к файлу JSON только с помощью базовой проверки подлинности.  Подключение к файлу JSON с помощью учетных данных в URL-адресе (например, `https://XXXXX.blob.core.windows.net/path/file.json?sv=2019-01-01&si=something&sr=c&sig=123456abcdefg`…) сейчас **не** поддерживается.  

* **Хранилище данных SQL Azure** — потоки данных сейчас не поддерживают проверку подлинности Azure Active Directory (AAD) для хранилища данных SQL Azure. Для этого сценария используйте базовую проверку подлинности.

## <a name="considerations-and-limitations"></a>Рекомендации и ограничения

Существует несколько известных ограничений для потоков данных, которые описаны в следующем списке.

* Поток данных должен выводить значения одного из следующих типов: *дата/время, десятичное число, текст, целое число, дата/время/зона, True/False, дата, время*;
* динамические функции в настоящее время не поддерживаются в потоках данных.


## <a name="next-steps"></a>Следующие шаги

В этой статье описано, как создать собственный **поток данных** и применить его в наборе данных и отчете, созданных в **Power BI Desktop**. Следующие статьи помогут получить дополнительные сведения и изучить сценарии применения потоков данных:

* [Self-service data prep in Power BI (Preview)](service-dataflows-overview.md) (Самостоятельная подготовка данных в Power BI (предварительная версия))
* [Использование вычисляемых сущностей в Power BI Premium](service-dataflows-computed-entities-premium.md)
* [Использование потоков данных с локальными источниками данных](service-dataflows-on-premises-gateways.md)
* [Ресурсы для разработчиков потоков данных Power BI](service-dataflows-developer-resources.md)
* [Потоки данных и интеграция Azure Data Lake (предварительная версия)](service-dataflows-azure-data-lake-integration.md)

Дополнительные сведения о модели общих данных вы найдете в этой обзорной статье:
* [Что такое модель общих данных?](https://docs.microsoft.com/powerapps/common-data-model/overview)
* [Дополнительные сведения о схеме модели общих данных и сущностях на сайте GitHub](https://github.com/Microsoft/CDM)

Связанные статьи о Power BI Desktop:

* [Подключение к наборам данных в службе Power BI из приложения Power BI Desktop](../connect-data/desktop-report-lifecycle-datasets.md)
* [Общие сведения о запросах в Power BI Desktop](desktop-query-overview.md)

Связанные статьи о службе Power BI:
* [Настройка запланированного обновления](../connect-data/refresh-scheduled-refresh.md)
